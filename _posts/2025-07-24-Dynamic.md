---
title: "DYNAMIC"
date: 2025-07-23 09:17:00 +0800
categories: [C]
tags: [C]
---

# üí° H∆∞·ªõng d·∫´n C·∫•p ph√°t ƒê·ªông trong C

v√≠ d·ª• th·ª±c t·∫ø v·ªÅ **dynamic memory allocation** (c·∫•p ph√°t ƒë·ªông) trong ng√¥n ng·ªØ l·∫≠p tr√¨nh C.

## üß† T·ªïng quan

C·∫•p ph√°t ƒë·ªông l√† qu√° tr√¨nh **c·∫•p ph√°t b·ªô nh·ªõ trong th·ªùi gian ch·∫°y (runtime)**, cho ph√©p ch∆∞∆°ng tr√¨nh s·ª≠ d·ª•ng b·ªô nh·ªõ linh ho·∫°t h∆°n.

## ‚öñÔ∏è So s√°nh v·ªõi c·∫•p ph√°t tƒ©nh
| C·∫•p ph√°t b·ªô nh·ªõ tƒ©nh| C·∫•p ph√°t b·ªô nh·ªõ ƒë·ªông|
|---------------------|---------------------|
|B·ªô nh·ªõ ƒë∆∞·ª£c c·∫•p ph√°t tr∆∞·ªõc khi ch·∫°y  ch∆∞∆°ng tr√¨nh (trong q√∫a tr√¨nh bi√™n d·ªãch)| B·ªô nh·ªõ ƒë∆∞·ª£c c·∫•p ph√°t trong qu√° tr√¨nh ch·∫°y ch∆∞∆°ng tr√¨nh.|
|Kh√¥ng th·ªÉ c·∫•p ph√°t h·∫°y ph√¢n b·ªï l·∫°i b·ªô nh·ªõ trong khii ch·∫°y ch∆∞∆°ng tr√¨nh| Cho ph√©p qu·∫£n l√Ω, ph√¢n b·ªë hay gi·∫£i ph√≥ng b·ªô nh·ªõ trong khi ch·∫°y ch∆∞∆°ng tr√¨nh|
|V√πng nh·ªõ ƒë∆∞·ª£c c·∫•p ph√°t v√† t·ªìn t·∫°i cho ƒë·∫øn khi k·∫øt th√∫c ch∆∞∆°ng tr√¨nh| Ch·ªâ c·∫•p ph√°t v√πng nh·ªõ khi c·∫ßn s·ª≠ d·ª•ng t·ªõi|
|Ch∆∞∆°ng tr√¨nh ch·∫°y nhanh h∆°n so v·ªõi c·∫•p ph√°t ƒë·ªông| Ch∆∞∆°ng tr√¨nh ch·∫°y ch·∫≠m h∆°n so v·ªõi c·∫•p ph√°t tƒ©nh|
|T·ªën nhi·ªÉu kh√¥ng gian b·ªô nh·ªõ h∆°n | Ti·∫øt ki·ªám ƒë∆∞·ª£c kh√¥ng gian b·ªô nh·ªõ s·ª≠ d·ª•ng|


## üõ†Ô∏è C√°c h√†m c·∫•p ph√°t ƒë·ªông

| H√†m     | Ch·ª©c nƒÉng                              |
|---------|----------------------------------------|
| `malloc()` | C·∫•p ph√°t b·ªô nh·ªõ ch∆∞a kh·ªüi t·∫°o       |
| `calloc()` | C·∫•p ph√°t b·ªô nh·ªõ v√† kh·ªüi t·∫°o v·ªÅ 0     |
| `realloc()`| Thay ƒë·ªïi k√≠ch th∆∞·ªõc v√πng nh·ªõ ƒë√£ c·∫•p |
| `free()`   | Gi·∫£i ph√≥ng b·ªô nh·ªõ ƒë√£ c·∫•p ph√°t       |

---

### üìå H√†m `malloc`
H√†m `malloc` c·∫•p ph√°t m·ªôt kh·ªëi b·ªô nh·ªõ c√≥ k√≠ch th∆∞·ªõc `size` (t√≠nh b·∫±ng byte). B·ªô nh·ªõ n√†y kh√¥ng ƒë∆∞·ª£c kh·ªüi t·∫°o gi√° tr·ªã v√† c√≥ th·ªÉ ch·ª©a c√°c gi√° tr·ªã ng·∫´u nhi√™n.

```c
void* malloc(size_t size);
int *ptr = (int*) malloc(10 * sizeof(int));  // C·∫•p ph√°t b·ªô nh·ªõ cho m·∫£ng 10 ph·∫ßn t·ª≠ ki·ªÉu int
```

üìå H√†m calloc
H√†m calloc t∆∞∆°ng t·ª± nh∆∞ malloc, nh∆∞ng ngo√†i vi·ªác c·∫•p ph√°t b·ªô nh·ªõ, n√≥ c√≤n kh·ªüi t·∫°o t·∫•t c·∫£ c√°c √¥ nh·ªõ ƒë√£ c·∫•p ph√°t v·ªÅ gi√° tr·ªã 0. b·ªô nh·ªõ c·∫•p ph√°t ra b·∫±ng num*size.

```c
void* calloc(size_t num, size_t size);
int *ptr = (int*) calloc(10, sizeof(int));  // C·∫•p ph√°t b·ªô nh·ªõ cho m·∫£ng 10 ph·∫ßn t·ª≠ ki·ªÉu int v√† kh·ªüi t·∫°o v·ªÅ 0
```

üìå H√†m free
H√†m free ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ ƒë√£ ƒë∆∞·ª£c c·∫•p ph√°t ƒë·ªông tr∆∞·ªõc ƒë√≥. Sau khi g·ªçi free, con tr·ªè ptr kh√¥ng c√≤n tr·ªè t·ªõi v√πng b·ªô nh·ªõ h·ª£p l·ªá n·ªØa, v√¨ v·∫≠y c·∫ßn ph·∫£i ƒë·∫£m b·∫£o kh√¥ng s·ª≠ d·ª•ng l·∫°i con tr·ªè ƒë√≥ m√† kh√¥ng c·∫•p ph√°t l·∫°i b·ªô nh·ªõ.

```c
free(ptr); //ptr l√† con tr·ªè
ptr = NULL; // ƒê·∫∑t con tr·ªè v·ªÅ NULL ƒë·ªÉ tr√°nh truy c·∫≠p v√πng b·ªô nh·ªõ kh√¥ng h·ª£p l·ªá
```

## üìå V√≠ d·ª• 1

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct {
    char *ten;
    int tuoi;
} sv_info_t;

int main() {
    sv_info_t sv1;
    sv1.ten = calloc(30, sizeof(char));  // c·∫•p ph√°t b·ªô nh·ªõ

    printf("Nhap ten: ");
    fgets(sv1.ten, 30, stdin);

    // X√≥a k√Ω t·ª± newline n·∫øu c√≥
    sv1.ten[strcspn(sv1.ten, "\n")] = '\0';

    printf("Nhap tuoi: ");
    scanf("%d", &sv1.tuoi);

    printf("Ten: %s\n", sv1.ten);
    printf("Tuoi: %d\n", sv1.tuoi);

    free(sv1.ten);  // gi·∫£i ph√≥ng b·ªô nh·ªõ ƒë√£ c·∫•p ph√°t

    return 0;
}

```
## üìå V√≠ d·ª• 2
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void in(int *arr, int n){
    for(int i = 0; i < n; i++){
        printf("arr[%d] = %d\n", i+1, arr[i]);
    }
}

int *them(int *arr, int *n){
    int a;
    printf("Nhap phan tu can them: ");
    scanf("%d", &a);
    int *arr_2 = (int*)calloc(*n+1, sizeof(int));
    memcpy(arr_2, arr, (*n)*sizeof(int));
    arr_2[*n] = a;
    free(arr);
    (*n)++;
    return arr_2;
}

int *xoa(int *arr,int *n,int index){
    for (int i = index; i < *n; i++)
    {
        arr[i] = arr[i+1];
    }
    (*n)--;
    int *arr_2 = calloc(*n, sizeof(int));
    memcpy(arr_2, arr, (*n)*sizeof(int));
    free(arr);
    return arr_2;
}

int main() {
    int n = 10;
    int *arr = (int*)calloc(10, sizeof(int));
    for(int i = 0; i < 10; i++){
        printf("arr[%d] = ", i+1);
        scanf("%d", arr+i);
    }
    in(arr, 10);
    arr = them(arr, &n);
    in(arr, n);
    arr = xoa(arr, &n, 2);
    in(arr, n);
    return 0;
}

```
*arr ch·ªâ l√† 1 con tr·ªè ƒëang tr·ªü ƒë·∫øn v√πng nh·ªõ, b·ªüi v·∫≠y n√™n khi free trong them th√¨ ch·ªâ gi·∫£i ph√≥ng ƒëi v√πng nh·ªõ th√¥i ch·ª© kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn con tr·ªè.

---

## üìå V√≠ d·ª• v·ªÅ l·ªói hay g·∫∑p c·ªßa c·∫•p ph√°t b·ªô nh·ªõ ƒë·ªông
```c
#include <stdio.h>
#include <stdint.h>

void capphatbonho(int *pt)
{
    pt = calloc(10, sizeof(int));
}

void main()
{
    int *pt;
    capphatbonho(pt);
    pt[0] = 1;
    printf("%d", pt[0]);
}
```
Khi b·∫°n g·ªçi h√†m capphatbonho(pt), b·∫°n ch·ªâ truy·ªÅn m·ªôt con tr·ªè pt v√†o h√†m, nh∆∞ng khi thay ƒë·ªïi gi√° tr·ªã c·ªßa pt b√™n trong h√†m, gi√° tr·ªã ƒë√≥ kh√¥ng ƒë∆∞·ª£c ph·∫£n √°nh ra b√™n ngo√†i v√¨ con tr·ªè n√†y ƒë∆∞·ª£c truy·ªÅn theo ki·ªÉu gi√° tr·ªã (pass-by-value). ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† vi·ªác c·∫•p ph√°t b·ªô nh·ªõ trong h√†m kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn con tr·ªè pt trong h√†m main.

S·ª≠a
```c
#include <stdio.h>

int* capphatbonho(void)
{
    int *pt = calloc(10, sizeof(int));
    if (pt == NULL) {
        printf("L·ªói: Kh√¥ng th·ªÉ c·∫•p ph√°t b·ªô nh·ªõ!\n");
        exit(1);
    }
    return pt;
}

int main()
{
    int *pt;
    pt = capphatbonho();
    pt[0] = 1;
    printf("%d\n", pt[0]);
    free(pt); // Gi·∫£i ph√≥ng b·ªô nh·ªõ
    return 0;
}
```

## üìå Ghi nh·ªõ
- ƒê√£ l√† con tr·ªè th√¨ lu√¥n lu√¥n tr·ªè ƒë·∫øn 1 v√πng nh·ªõ, sau ƒë√≥ h√£y t√°c ƒë·ªông v√†o n√≥.
- Ch·∫°y xong c·∫•p ph√°t ƒë·ªông ph·∫£i free ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ
---