---
title: "SPI"
date: 2025-07-24 22:41:00 +0800
categories: [Protocol]
tags: [Protocol]
---

# ğŸ”„ SPI (Serial Peripheral Interface)

## ğŸ“ Tá»•ng quan

SPI (Serial Peripheral Interface) lÃ  má»™t chuáº©n giao tiáº¿p ná»‘i tiáº¿p Ä‘á»“ng bá»™, thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ truyá»n dá»¯ liá»‡u giá»¯a vi Ä‘iá»u khiá»ƒn vÃ  cÃ¡c thiáº¿t bá»‹ ngoáº¡i vi nhÆ° cáº£m biáº¿n, bá»™ nhá»›, mÃ n hÃ¬nh, v.v. SPI sá»­ dá»¥ng bá»‘n Ä‘Æ°á»ng tÃ­n hiá»‡u chÃ­nh:

- ğŸ“¤ **MOSI (Master Out Slave In)**: Dá»¯ liá»‡u tá»« Master Ä‘áº¿n Slave
- ğŸ“¥ **MISO (Master In Slave Out)**: Dá»¯ liá»‡u tá»« Slave Ä‘áº¿n Master
- â° **SCK (Serial Clock)**: Xung nhá»‹p do Master táº¡o ra
- ğŸ¯ **SS/CS (Slave Select/Chip Select)**: Chá»n thiáº¿t bá»‹ Slave

> SPI cÃ³ tá»‘c Ä‘á»™ truyá»n dá»¯ liá»‡u cao, cáº¥u trÃºc Ä‘Æ¡n giáº£n vÃ  dá»… triá»ƒn khai trong cÃ¡c á»©ng dá»¥ng nhÃºng.

---

## ğŸ› ï¸ HÆ°á»›ng dáº«n giao tiáº¿p SPI

### 1. ğŸ“Œ Giá»›i thiá»‡u SPI
SPI (Serial Peripheral Interface) lÃ  giao tiáº¿p ná»‘i tiáº¿p Ä‘á»“ng bá»™, thÆ°á»ng dÃ¹ng Ä‘á»ƒ káº¿t ná»‘i vi Ä‘iá»u khiá»ƒn vá»›i cÃ¡c ngoáº¡i vi nhÆ° cáº£m biáº¿n, bá»™ nhá»›, mÃ n hÃ¬nh, v.v.

### 2. ğŸ”Œ CÃ¡c chÃ¢n tÃ­n hiá»‡u SPI
- ğŸ“¤ **MOSI (Master Out Slave In):** Truyá»n dá»¯ liá»‡u tá»« Master Ä‘áº¿n Slave
- ğŸ“¥ **MISO (Master In Slave Out):** Truyá»n dá»¯ liá»‡u tá»« Slave Ä‘áº¿n Master
- â° **SCK (Serial Clock):** Xung nhá»‹p do Master táº¡o ra
- ğŸ¯ **SS/CS (Slave Select/Chip Select):** Chá»n thiáº¿t bá»‹ Slave

### 5. âš ï¸ LÆ°u Ã½ khi sá»­ dá»¥ng SPI
- âš¡ Äáº£m báº£o cáº¥u hÃ¬nh Ä‘Ãºng tá»‘c Ä‘á»™ vÃ  cháº¿ Ä‘á»™ clock giá»¯a Master vÃ  Slave
- ğŸ”Œ Kiá»ƒm tra káº¿t ná»‘i dÃ¢y Ä‘Ãºng thá»© tá»± cÃ¡c chÃ¢n
- ğŸ”’ Sá»­ dá»¥ng trá»Ÿ kÃ©o lÃªn/kÃ©o xuá»‘ng náº¿u cáº§n thiáº¿t cho chÃ¢n CS

---

## ğŸ”„ CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a SPI

<div align="center">
  <img src="image-1.png" alt="How SPI Works" width="800"/>
</div>

### ğŸ“Š Giáº£n Ä‘á»“ thá»i gian truyá»n dá»¯ liá»‡u

Trong vÃ­ dá»¥ trÃªn, ta cÃ³ thá»ƒ tháº¥y:

1. ğŸ”„ **Truyá»n dá»¯ liá»‡u tá»« Master Ä‘áº¿n Slave (MOSI)**:
   - Master gá»­i kÃ½ tá»± 'S' (0x53 trong ASCII)
   - Dá»¯ liá»‡u: `1 1 0 0 1 0 1 0` (LSB first)
   - ÄÆ°á»£c truyá»n theo tá»«ng bit táº¡i má»—i xung clock

2. ğŸ”„ **Truyá»n dá»¯ liá»‡u tá»« Slave Ä‘áº¿n Master (MISO)**:
   - Slave gá»­i kÃ½ tá»± 'F' (0x46 trong ASCII)
   - Dá»¯ liá»‡u: `0 1 1 0 0 0 1 0` (LSB first)
   - ÄÆ°á»£c truyá»n Ä‘á»“ng thá»i vá»›i dá»¯ liá»‡u MOSI

3. â° **Xung clock (SCK)**:
   - Do Master táº¡o ra
   - 8 xung clock cho má»—i byte dá»¯ liá»‡u
   - Táº§n sá»‘ cÃ³ thá»ƒ Ä‘Æ°á»£c cáº¥u hÃ¬nh (thÆ°á»ng tá»« vÃ i trÄƒm kHz Ä‘áº¿n vÃ i MHz)

4. ğŸ¯ **Slave Select (SS/CS)**:
   - KÃ©o xuá»‘ng má»©c tháº¥p khi báº¯t Ä‘áº§u truyá»n
   - Giá»¯ má»©c tháº¥p trong suá»‘t quÃ¡ trÃ¬nh truyá»n
   - KÃ©o lÃªn má»©c cao khi káº¿t thÃºc

### ğŸ” Äáº·c Ä‘iá»ƒm quan trá»ng

1. ğŸ” **Truyá»n song song hai chiá»u**:
   - MOSI vÃ  MISO hoáº¡t Ä‘á»™ng Ä‘á»“ng thá»i
   - Trong má»™t chu ká»³ truyá»n 8 bit:
     * Master gá»­i 1 byte qua MOSI
     * Äá»“ng thá»i nháº­n 1 byte tá»« MISO

2. ğŸ® **Äiá»u khiá»ƒn bá»Ÿi Master**:
   ```
   Master â”€â”€â”€â”€â”€â”€â”
      â”‚ SCK  â”€â”€â”€â”¼â”€â”€> Slave
      â”‚ MOSI â”€â”€â”€â”¼â”€â”€>
      â”‚ MISO <â”€â”€â”¼â”€â”€â”€
      â”‚ SS   â”€â”€â”€â”¼â”€â”€>
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

3. âš¡ **Æ¯u Ä‘iá»ƒm**:
   - Tá»‘c Ä‘á»™ truyá»n cao (cÃ³ thá»ƒ Ä‘áº¡t hÃ ng chá»¥c MHz)
   - Full-duplex (truyá»n vÃ  nháº­n cÃ¹ng lÃºc)
   - Giao thá»©c Ä‘Æ¡n giáº£n, dá»… cÃ i Ä‘áº·t
   - KhÃ´ng cáº§n Ä‘á»‹a chá»‰ nhÆ° I2C
   - KhÃ´ng cáº§n bá»™ Ä‘á»‡m nhÆ° UART

4. ğŸ“ **NhÆ°á»£c Ä‘iá»ƒm**:
   - Cáº§n nhiá»u dÃ¢y (4 dÃ¢y cho 1 slave)
   - Khoáº£ng cÃ¡ch truyá»n ngáº¯n
   - KhÃ´ng cÃ³ cÆ¡ cháº¿ kiá»ƒm tra lá»—i
   - Chá»‰ há»— trá»£ má»™t master

---

### ğŸ”„ SPI MODE

SPI cÃ³ 4 cháº¿ Ä‘á»™ hoáº¡t Ä‘á»™ng (MODE) khÃ¡c nhau, Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi hai tham sá»‘:
- ğŸ”µ **CPOL (Clock Polarity)**: XÃ¡c Ä‘á»‹nh má»©c logic cá»§a chÃ¢n SCK khi khÃ´ng truyá»n dá»¯ liá»‡u
  - CPOL = 0: SCK á»Ÿ má»©c tháº¥p khi nghá»‰
  - CPOL = 1: SCK á»Ÿ má»©c cao khi nghá»‰
- ğŸ”´ **CPHA (Clock Phase)**: XÃ¡c Ä‘á»‹nh thá»i Ä‘iá»ƒm láº¥y máº«u dá»¯ liá»‡u
  - CPHA = 0: Láº¥y máº«u táº¡i cáº¡nh Ä‘áº§u tiÃªn cá»§a SCK
  - CPHA = 1: Láº¥y máº«u táº¡i cáº¡nh thá»© hai cá»§a SCK

#### Báº£ng cÃ¡c cháº¿ Ä‘á»™ SPI:

| Mode | CPOL | CPHA | Tráº¡ng thÃ¡i nghá»‰ SCK | Cáº¡nh láº¥y máº«u |
|------|------|------|---------------------|--------------|
| 0    | 0    | 0    | Má»©c tháº¥p           | Cáº¡nh lÃªn     |
| 1    | 0    | 1    | Má»©c tháº¥p           | Cáº¡nh xuá»‘ng   |
| 2    | 1    | 0    | Má»©c cao            | Cáº¡nh xuá»‘ng   |
| 3    | 1    | 1    | Má»©c cao            | Cáº¡nh lÃªn     |

![alt text](/assets/Protocol/spi_mode.png)
