---
title: "UNION"
date: 2025-07-24 19:37:00 +0800
categories: [C]
tags: [C]
---

# ğŸ“– HÆ°á»›ng dáº«n vá» Union trong c

vÃ­ dá»¥ thá»±c táº¿ vÃ  giáº£i thÃ­ch rÃµ rÃ ng vá» **union** trong láº­p trÃ¬nh c.

## ğŸ§  Tá»•ng quan

`Union` lÃ  dá»¯ liá»‡u Ä‘áº·c biá»‡t trong ngÃ´n ngá»¯ c cho phÃ©p báº¡n dá»± trá»¯ cÃ¡c kiá»ƒu dá»¯ liá»‡u khÃ¡c nhau trong cÃ¹ng 1 vÃ¹ng nhá»›. Báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a Union vá»›i ráº¥t nhiá»u tham sá»‘, nhÆ°ng chá»‰ má»™t thÃ nh pháº§n chá»©a giÃ¡ trá»‹ táº¡i má»™t thá»i Ä‘iá»ƒm.

---

## âš™ï¸ cÃ¡ch khai bÃ¡o union

### Khai bÃ¡o tÆ°á»ng minh:
```c
union unionName {
    dataType member1;
    dataType member2;
    // cÃ¡c thÃ nh viÃªn khÃ¡c
};
```
#### VÃ­ dá»¥:
```c
union Hoclaptrinh {
    int i;
    float f;
    char chuoi[50];
};
```
### Khai bÃ¡o khÃ´ng tÆ°á»ng minh (sá»­ dá»¥ng typedef):
```c
typedef union {
    dataType member1;
    dataType member2;
    // cÃ¡c thÃ nh viÃªn khÃ¡c
} unionName;
```
#### VÃ­ dá»¥:
```c
typedef union {
    int i;
    float f;
    char chuoi[50];
} Hoclaptrinh;
```
KhÃ¡c vá»›i struct lÃ  vá» cÃ¡ch quáº£n lÃ½ bá»™ nhá»›, cÃ²n cÃ¡ch dÃ¹ng thÃ¬ giá»‘ng nhau.

## ğŸ” Truy cáº­p thÃ nh viÃªn cá»§a union
cÃ¡c thÃ nh viÃªn cá»§a `union` Ä‘Æ°á»£c truy cáº­p báº±ng toÃ¡n tá»­ `.` (dáº¥u cháº¥m), tÆ°Æ¡ng tá»± nhÆ° `struct`.
### VÃ­ dá»¥:
```c
#include <stdio.h>

union Data {
    int i;
    float f;
    char str[20];
};

int main() {
    union Data data;

    data.i = 10;
    printf("data.i: %d\n", data.i);

    data.f = 220.5;
    printf("data.f: %.2f\n", data.f);

    // LÆ°u Ã½: GiÃ¡ trá»‹ cá»§a `data.i` sáº½ bá»‹ ghi Ä‘Ã¨ bá»Ÿi `data.f`
    return 0;
}
```
## ğŸ”„ Sá»± khÃ¡c biá»‡t giá»¯a struct vÃ  union
### 1. Vá» bá»™ nhá»›
- **struct**: Má»—i thÃ nh viÃªn cÃ³ vÃ¹ng nhá»› riÃªng biá»‡t
- **union**: CÃ¡c thÃ nh viÃªn chia sáº» cÃ¹ng má»™t vÃ¹ng nhá»›

### 2. Vá» kÃ­ch thÆ°á»›c
- **struct**: Tá»•ng kÃ­ch thÆ°á»›c cá»§a táº¥t cáº£ thÃ nh viÃªn
- **union**: KÃ­ch thÆ°á»›c cá»§a thÃ nh viÃªn lá»›n nháº¥t

### 3. Vá» truy cáº­p Ä‘á»“ng thá»i
- **struct**: CÃ¡c thÃ nh viÃªn cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p Ä‘á»“ng thá»i
- **union**: Chá»‰ má»™t thÃ nh viÃªn cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p táº¡i má»™t thá»i Ä‘iá»ƒm

### 4. Vá» á»©ng dá»¥ng
- **struct**: 
  - LÆ°u trá»¯ dá»¯ liá»‡u phá»©c táº¡p
  - CÃ¡c thÃ nh viÃªn Ä‘á»™c láº­p vá»›i nhau
- **union**:
  - Tiáº¿t kiá»‡m bá»™ nhá»› 
  - DÃ¹ng khi cÃ¡c thÃ nh viÃªn khÃ´ng cáº§n tá»“n táº¡i Ä‘á»“ng thá»i
  
![alt text](/assets/C/union2.png)
### VÃ­ dá»¥:
```c
#include <stdio.h>
#include <string.h>

typedef union gt {
    int x;
    float y;
    char c[30];
} gt_t;
int main() {
    gt_t a;
    a.x = 100;
    a.y = 3.14;
    strcpy(a.c, "Loo_D");

    printf("x lÃ  %d\n", a.x);
    printf("y lÃ  %.2f\n", a.y);
    printf("c lÃ  %s\n", a.c);

    return 0;
}
```
![alt text](/assets/C/union2.png)

Union nÃ³ tÃ¬m ra pháº§n tá»­ cÃ³ kÃ­ch thÆ°á»›c lá»›n nháº¥t vÃ  nÃ³ chá»‰ cáº¥p phÃ¡t Ã´ nhá»› cho pháº§n tá»­ cÃ³ kÃ­ch thÆ°á»›c lá»›n nháº¥t.

VÃ­ dá»¥ trÃªn khai bÃ¡o c gá»“m 30 pháº§n tá»­ nÃªn 30 byte lÃ  lá»›n nháº¥t nÃªn chá»‰ cáº¥p phÃ¡t cho c.

Khi vÃ o hÃ m main hoáº¡t Ä‘á»™ng thÃ¬ gÃ¡n pháº§n tá»­ x báº±ng 100 thÃ¬ lÃºc nÃ y nÃ³ ghi giÃ¡ trá»‹ vÃ o 30byte vá»«a cáº¥p phÃ¡t. VÃ  tiáº¿p theo nÃ³ gÃ¡n y báº±ng 3.14 thÃ¬ lÃºc nÃ y y ghi Ä‘Ã¨ giÃ¡ trá»‹ vÃ o 30 byte thÃ¬ lÃºc nÃ y x khÃ´ng cÃ²n ghi trong Ä‘Ã³ ná»¯a nÃªn sinh ra giÃ¡ trá»‹ rÃ¡c.

Khi thá»±c hiá»‡n lá»‡nh strcpy copy "Loo_D" vÃ o pháº§n tá»­ c thÃ¬ lÃºc nÃ y nÃ³ láº¡i ghi Ä‘Ã¨ lÃªn y lÃ  ghi vÃ o 30byte Ä‘Ã³ nÃªn y cÅ©ng máº¥t. VÃ¬ tháº¿ khi in ra thÃ¬ x vÃ  y khÃ´ng Ä‘Ãºng.

**Káº¿t luáº­n: Union vd trÃªn cÃ³ kÃ­ch thÆ°á»›c 30byte vÃ  cÃ¡c pháº§n tá»­ sá»­ dá»¥ng chung 30 byte Ä‘Ã³. VÃ  union sinh ra Ä‘á»ƒ tiáº¿t kiá»‡m Ã´ nhá»› vÃ¬ táº¡i 1 thá»i Ä‘iá»ƒm chá»‰ sá»­ dá»¥ng 1 pháº§n tá»­ Ä‘Æ°á»£c sá»­ dá»¥ng vÃ  cÃ³ giÃ¡ trá»‹ há»£p lá»‡.
### VÃ­ dá»¥: 
```c
typedef struct {
    char ten[30];
    int _level;
} giangvien_info_t;

typedef struct {
    char ten[30];
    int _class;
} sinhvien_info_t;

typedef union {
    giangvien_info_t gv;
    sinhvien_info_t sv;
} info_t;

int main() {
    info_t info; // 34 bytes

    printf("Nhap ten giang vien: ");
    gets(info.gv.ten);
    printf("Ten gv: %s\n", info.gv.ten);

    printf("Nhap ten sinh vien: ");
    gets(info.sv.ten);
    printf("Ten sv: %s\n", info.sv.ten);

    return 0;
}
```
## ğŸ’¡ á»¨ng dá»¥ng cá»§a Union trong Embedded Systems
### 1. **Quáº£n lÃ½ thanh ghi**
```c
#include <stdio.h>
#include <stdint.h>

// Äá»‹nh nghÄ©a union cho motor control
typedef union {
    struct {
        uint8_t start   :1;   // Bit 0: Báº­t/táº¯t Ä‘á»™ng cÆ¡
        uint8_t stop    :1;   // Bit 1: Dá»«ng Ä‘á»™ng cÆ¡
        uint8_t reverse :1;   // Bit 2: Äáº£o chiá»u Ä‘á»™ng cÆ¡
        uint8_t fault   :1;   // Bit 3: BÃ¡o lá»—i
        uint8_t reserved:4;   // Bit 4-7: Dá»± phÃ²ng
    } bits;
    uint8_t all;              // Truy cáº­p toÃ n bá»™ 8 bits
} MotorcontrolReg;

MotorcontrolReg motorReg;

void printMotorStatus(void) {
    printf("Motor Status: start=%d, stop=%d, reverse=%d, fault=%d, raw=0x%02X\n",
           motorReg.bits.start,
           motorReg.bits.stop,
           motorReg.bits.reverse,
           motorReg.bits.fault,
           motorReg.all);
}

int main(void) {
    printf("=== Äiá»u khiá»ƒn Ä‘á»™ng cÆ¡ ===\n");

    // Báº­t Ä‘á»™ng cÆ¡
    motorReg.bits.start = 1;
    // KhÃ´ng Ä‘áº£o chiá»u
    motorReg.bits.reverse = 0;
    // Dá»«ng Ä‘á»™ng cÆ¡ (khÃ´ng dá»«ng)
    motorReg.bits.stop = 0;
    // KhÃ´ng bÃ¡o lá»—i
    motorReg.bits.fault = 0;

    printMotorStatus();

    // Ghi trá»±c tiáº¿p cáº£ byte
    motorReg.all = 0x0F;  // 00001111b â†’ start=1, stop=1, reverse=1, fault=1

    printMotorStatus();

    return 0;
}
```
**Káº¿t Quáº£**
```c
=== Äiá»u khiá»ƒn Ä‘á»™ng cÆ¡ ===
Motor Status: start=1, stop=0, reverse=0, fault=0, raw=0x01
Motor Status: start=1, stop=1, reverse=1, fault=1, raw=0x0F
```

### **chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u (byte â†” int â†” float)**
```c
#include <stdio.h>
#include <stdint.h>

// Union dÃ¹ng Ä‘á»ƒ chuyá»ƒn Ä‘á»•i giá»¯a float, int, vÃ  byte array
typedef union {
    float f;            // 4 byte float
    uint32_t i;         // 4 byte integer
    uint8_t bytes[4];   // 4 byte riÃªng láº»
} Dataconverter;

int main(void) {
    Dataconverter data;

    // GÃ¡n giÃ¡ trá»‹ float
    data.f = 3.14159f;

    printf("=== chuyá»ƒn Ä‘á»•i tá»« float ===\n");
    printf("Float: %f\n", data.f);
    printf("Integer: 0x%08X\n", data.i);
    printf("Bytes: %02X %02X %02X %02X\n", data.bytes[0], data.bytes[1], data.bytes[2], data.bytes[3]);

    // Giáº£ sá»­ truyá»n nháº­n dá»¯ liá»‡u, ta chá»‰ cÃ³ 4 bytes:
    uint8_t received_bytes[4] = { 0xDB, 0x0F, 0x49, 0x40 }; // Dá»¯ liá»‡u float 3.14159 dáº¡ng byte

    // copy vÃ o data
    for (int i = 0; i < 4; i++) {
        data.bytes[i] = received_bytes[i];
    }

    printf("\n=== Sau khi nháº­n tá»« 4 bytes ===\n");
    printf("Float: %f\n", data.f);
    printf("Integer: 0x%08X\n", data.i);

    return 0;
}
```
**Káº¿t Quáº£**
```c
=== chuyá»ƒn Ä‘á»•i tá»« float ===
Float: 3.141590
Integer: 0x40490FDB
Bytes: DB 0F 49 40

=== Sau khi nháº­n tá»« 4 bytes ===
Float: 3.141590
Integer: 0x40490FDB
```
Báº¡n gÃ¡n cho data.f giÃ¡ trá»‹ float 3.14159.

Trong mÃ¡y tÃ­nh, float khÃ´ng lÆ°u dÆ°á»›i dáº¡ng sá»‘ tháº­p phÃ¢n nhÆ° báº¡n nghÄ©, mÃ  nÃ³ mÃ£ hÃ³a theo chuáº©n IEEE-754 (chuáº©n sá»‘ thá»±c dáº¥u pháº©y Ä‘á»™ng 32-bit).

âœ… Sá»‘ 3.14159 trong chuáº©n IEEE-754 (float 32-bit) cÃ³ dáº¡ng hex lÃ : `0x40490FDB`

### **Tá»‘i Æ°u bá»™ nhá»›**
```c
#include <stdio.h>

typedef union {
    int intValue;
    float floatValue;
    char str[20];
} Data;

int main() {
    Data data;

    data.intValue = 42;
    printf("Integer: %d\n", data.intValue);

    data.floatValue = 3.14;
    printf("Float: %.2f\n", data.floatValue);

    return 0;
}
```
### **LÃ m viá»‡c vá»›i giao tiáº¿p ngoáº¡i vi (UART, SPI, I2c, LoRa, cAN, Modbus...)**
```c
#include <stdio.h>
#include <stdint.h>  // ThÆ° viá»‡n dÃ¹ng kiá»ƒu uint8_t, uint16_t chuáº©n

// Äá»‹nh nghÄ©a kiá»ƒu dá»¯ liá»‡u Union Ä‘á»ƒ truy cáº­p 2 byte cá»§a má»™t tá»« 16-bit
typedef union {
    struct {
        uint8_t lowByte;     // Byte tháº¥p (8 bits Ä‘áº§u tiÃªn)
        uint8_t highByte;    // Byte cao (8 bits tiáº¿p theo)
    } bytes;
    uint16_t word;           // ToÃ n bá»™ 16 bits
} SPI_Data;

int main() {
    SPI_Data spiData;

    // GÃ¡n giÃ¡ trá»‹ 16-bit cho word
    spiData.word = 0xABcD;   // 0xAB lÃ  high byte, 0xcD lÃ  low byte

    // In ra tá»«ng byte
    printf("Word: 0x%04X\n", spiData.word);
    printf("High Byte: 0x%02X\n", spiData.bytes.highByte);
    printf("Low Byte: 0x%02X\n", spiData.bytes.lowByte);

    return 0;
}
```


