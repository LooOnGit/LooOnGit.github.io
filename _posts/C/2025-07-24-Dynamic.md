---
title: "DYNAMIC"
date: 2025-07-23 09:17:48 +0800
categories: [C]
tags: [C]
---

# ğŸ’¡ HÆ°á»›ng dáº«n Cáº¥p phÃ¡t Äá»™ng trong C

vÃ­ dá»¥ thá»±c táº¿ vá» **dynamic memory allocation** (cáº¥p phÃ¡t Ä‘á»™ng) trong ngÃ´n ngá»¯ láº­p trÃ¬nh C.

## ğŸ§  Tá»•ng quan

Cáº¥p phÃ¡t Ä‘á»™ng lÃ  quÃ¡ trÃ¬nh **cáº¥p phÃ¡t bá»™ nhá»› trong thá»i gian cháº¡y (runtime)**, cho phÃ©p chÆ°Æ¡ng trÃ¬nh sá»­ dá»¥ng bá»™ nhá»› linh hoáº¡t hÆ¡n.

## âš–ï¸ So sÃ¡nh vá»›i cáº¥p phÃ¡t tÄ©nh

| Cáº¥p phÃ¡t bá»™ nhá»› tÄ©nh| Cáº¥p phÃ¡t bá»™ nhá»› Ä‘á»™ng|
|---------------------|---------------------|
|Bá»™ nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t trÆ°á»›c khi cháº¡y  chÆ°Æ¡ng trÃ¬nh (trong qÃºa trÃ¬nh biÃªn dá»‹ch)| Bá»™ nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t trong quÃ¡ trÃ¬nh cháº¡y chÆ°Æ¡ng trÃ¬nh.|
|KhÃ´ng thá»ƒ cáº¥p phÃ¡t háº¡y phÃ¢n bá»• láº¡i bá»™ nhá»› trong khii cháº¡y chÆ°Æ¡ng trÃ¬nh| Cho phÃ©p quáº£n lÃ½, phÃ¢n bá»‘ hay giáº£i phÃ³ng bá»™ nhá»› trong khi cháº¡y chÆ°Æ¡ng trÃ¬nh|
|VÃ¹ng nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t vÃ  tá»“n táº¡i cho Ä‘áº¿n khi káº¿t thÃºc chÆ°Æ¡ng trÃ¬nh| Chá»‰ cáº¥p phÃ¡t vÃ¹ng nhá»› khi cáº§n sá»­ dá»¥ng tá»›i|
|ChÆ°Æ¡ng trÃ¬nh cháº¡y nhanh hÆ¡n so vá»›i cáº¥p phÃ¡t Ä‘á»™ng| ChÆ°Æ¡ng trÃ¬nh cháº¡y cháº­m hÆ¡n so vá»›i cáº¥p phÃ¡t tÄ©nh|
|Tá»‘n nhiá»ƒu khÃ´ng gian bá»™ nhá»› hÆ¡n | Tiáº¿t kiá»‡m Ä‘Æ°á»£c khÃ´ng gian bá»™ nhá»› sá»­ dá»¥ng|


## ğŸ› ï¸ CÃ¡c hÃ m cáº¥p phÃ¡t Ä‘á»™ng

| HÃ m     | Chá»©c nÄƒng                              |
|---------|----------------------------------------|
| `malloc()` | Cáº¥p phÃ¡t bá»™ nhá»› chÆ°a khá»Ÿi táº¡o       |
| `calloc()` | Cáº¥p phÃ¡t bá»™ nhá»› vÃ  khá»Ÿi táº¡o vá» 0     |
| `realloc()`| Thay Ä‘á»•i kÃ­ch thÆ°á»›c vÃ¹ng nhá»› Ä‘Ã£ cáº¥p |
| `free()`   | Giáº£i phÃ³ng bá»™ nhá»› Ä‘Ã£ cáº¥p phÃ¡t       |

---

### ğŸ“Œ HÃ m `malloc`
HÃ m `malloc` cáº¥p phÃ¡t má»™t khá»‘i bá»™ nhá»› cÃ³ kÃ­ch thÆ°á»›c `size` (tÃ­nh báº±ng byte). Bá»™ nhá»› nÃ y khÃ´ng Ä‘Æ°á»£c khá»Ÿi táº¡o giÃ¡ trá»‹ vÃ  cÃ³ thá»ƒ chá»©a cÃ¡c giÃ¡ trá»‹ ngáº«u nhiÃªn.

```c
void* malloc(size_t size);
int *ptr = (int*) malloc(10 * sizeof(int));  // Cáº¥p phÃ¡t bá»™ nhá»› cho máº£ng 10 pháº§n tá»­ kiá»ƒu int
```

ğŸ“Œ HÃ m calloc
HÃ m calloc tÆ°Æ¡ng tá»± nhÆ° malloc, nhÆ°ng ngoÃ i viá»‡c cáº¥p phÃ¡t bá»™ nhá»›, nÃ³ cÃ²n khá»Ÿi táº¡o táº¥t cáº£ cÃ¡c Ã´ nhá»› Ä‘Ã£ cáº¥p phÃ¡t vá» giÃ¡ trá»‹ 0. bá»™ nhá»› cáº¥p phÃ¡t ra báº±ng num*size.

```c
void* calloc(size_t num, size_t size);
int *ptr = (int*) calloc(10, sizeof(int));  // Cáº¥p phÃ¡t bá»™ nhá»› cho máº£ng 10 pháº§n tá»­ kiá»ƒu int vÃ  khá»Ÿi táº¡o vá» 0
```

ğŸ“Œ HÃ m free
HÃ m free Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ giáº£i phÃ³ng bá»™ nhá»› Ä‘Ã£ Ä‘Æ°á»£c cáº¥p phÃ¡t Ä‘á»™ng trÆ°á»›c Ä‘Ã³. Sau khi gá»i free, con trá» ptr khÃ´ng cÃ²n trá» tá»›i vÃ¹ng bá»™ nhá»› há»£p lá»‡ ná»¯a, vÃ¬ váº­y cáº§n pháº£i Ä‘áº£m báº£o khÃ´ng sá»­ dá»¥ng láº¡i con trá» Ä‘Ã³ mÃ  khÃ´ng cáº¥p phÃ¡t láº¡i bá»™ nhá»›.

```c
free(ptr); //ptr lÃ  con trá»
ptr = NULL; // Äáº·t con trá» vá» NULL Ä‘á»ƒ trÃ¡nh truy cáº­p vÃ¹ng bá»™ nhá»› khÃ´ng há»£p lá»‡
```

## ğŸ“Œ VÃ­ dá»¥ 1

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct {
    char *ten;
    int tuoi;
} sv_info_t;

int main() {
    sv_info_t sv1;
    sv1.ten = calloc(30, sizeof(char));  // cáº¥p phÃ¡t bá»™ nhá»›

    printf("Nhap ten: ");
    fgets(sv1.ten, 30, stdin);

    // XÃ³a kÃ½ tá»± newline náº¿u cÃ³
    sv1.ten[strcspn(sv1.ten, "\n")] = '\0';

    printf("Nhap tuoi: ");
    scanf("%d", &sv1.tuoi);

    printf("Ten: %s\n", sv1.ten);
    printf("Tuoi: %d\n", sv1.tuoi);

    free(sv1.ten);  // giáº£i phÃ³ng bá»™ nhá»› Ä‘Ã£ cáº¥p phÃ¡t

    return 0;
}

```
## ğŸ“Œ VÃ­ dá»¥ 2
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void in(int *arr, int n){
    for(int i = 0; i < n; i++){
        printf("arr[%d] = %d\n", i+1, arr[i]);
    }
}

int *them(int *arr, int *n){
    int a;
    printf("Nhap phan tu can them: ");
    scanf("%d", &a);
    int *arr_2 = (int*)calloc(*n+1, sizeof(int));
    memcpy(arr_2, arr, (*n)*sizeof(int));
    arr_2[*n] = a;
    free(arr);
    (*n)++;
    return arr_2;
}

int *xoa(int *arr,int *n,int index){
    for (int i = index; i < *n; i++)
    {
        arr[i] = arr[i+1];
    }
    (*n)--;
    int *arr_2 = calloc(*n, sizeof(int));
    memcpy(arr_2, arr, (*n)*sizeof(int));
    free(arr);
    return arr_2;
}

int main() {
    int n = 10;
    int *arr = (int*)calloc(10, sizeof(int));
    for(int i = 0; i < 10; i++){
        printf("arr[%d] = ", i+1);
        scanf("%d", arr+i);
    }
    in(arr, 10);
    arr = them(arr, &n);
    in(arr, n);
    arr = xoa(arr, &n, 2);
    in(arr, n);
    return 0;
}

```
*arr chá»‰ lÃ  1 con trá» Ä‘ang trá»Ÿ Ä‘áº¿n vÃ¹ng nhá»›, bá»Ÿi váº­y nÃªn khi free trong them thÃ¬ chá»‰ giáº£i phÃ³ng Ä‘i vÃ¹ng nhá»› thÃ´i chá»© khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n con trá».

---

## ğŸ“Œ VÃ­ dá»¥ vá» lá»—i hay gáº·p cá»§a cáº¥p phÃ¡t bá»™ nhá»› Ä‘á»™ng
```c
#include <stdio.h>
#include <stdint.h>

void capphatbonho(int *pt)
{
    pt = calloc(10, sizeof(int));
}

void main()
{
    int *pt;
    capphatbonho(pt);
    pt[0] = 1;
    printf("%d", pt[0]);
}
```
Khi báº¡n gá»i hÃ m capphatbonho(pt), báº¡n chá»‰ truyá»n má»™t con trá» pt vÃ o hÃ m, nhÆ°ng khi thay Ä‘á»•i giÃ¡ trá»‹ cá»§a pt bÃªn trong hÃ m, giÃ¡ trá»‹ Ä‘Ã³ khÃ´ng Ä‘Æ°á»£c pháº£n Ã¡nh ra bÃªn ngoÃ i vÃ¬ con trá» nÃ y Ä‘Æ°á»£c truyá»n theo kiá»ƒu giÃ¡ trá»‹ (pass-by-value). Äiá»u nÃ y cÃ³ nghÄ©a lÃ  viá»‡c cáº¥p phÃ¡t bá»™ nhá»› trong hÃ m khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n con trá» pt trong hÃ m main.

Sá»­a
```c
#include <stdio.h>

int* capphatbonho(void)
{
    int *pt = calloc(10, sizeof(int));
    if (pt == NULL) {
        printf("Lá»—i: KhÃ´ng thá»ƒ cáº¥p phÃ¡t bá»™ nhá»›!\n");
        exit(1);
    }
    return pt;
}

int main()
{
    int *pt;
    pt = capphatbonho();
    pt[0] = 1;
    printf("%d\n", pt[0]);
    free(pt); // Giáº£i phÃ³ng bá»™ nhá»›
    return 0;
}
```

## ğŸ“Œ Ghi nhá»›
- ÄÃ£ lÃ  con trá» thÃ¬ luÃ´n luÃ´n trá» Ä‘áº¿n 1 vÃ¹ng nhá»›, sau Ä‘Ã³ hÃ£y tÃ¡c Ä‘á»™ng vÃ o nÃ³.
- Cháº¡y xong cáº¥p phÃ¡t Ä‘á»™ng pháº£i free Ä‘á»ƒ giáº£i phÃ³ng bá»™ nhá»›

## ğŸ“Œ KhÃ¡c nhau giá»¯a cáº¥p phÃ¡t Ä‘á»™ng vÃ  cáº¥p phÃ¡t tÄ©nh
### Cáº¥p phÃ¡t tÄ©nh (Static Allocation)
**Äáº·c Ä‘iá»ƒm:**
- Bá»™ nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t ngay khi biÃªn dá»‹ch (compile time).
- VÃ¹ng nhá»› thÆ°á»ng náº±m á»Ÿ stack hoáº·c data segment (RAM hoáº·c Flash, tÃ¹y biáº¿n).
- KÃ­ch thÆ°á»›c pháº£i biáº¿t trÆ°á»›c (háº±ng sá»‘, cá»‘ Ä‘á»‹nh).

**Æ¯u Ä‘iá»ƒm:**
âœ… Nhanh, vÃ¬ bá»™ nhá»› Ä‘Æ°á»£c chuáº©n bá»‹ sáºµn.
âœ… An toÃ n hÆ¡n, Ã­t rá»§i ro lá»—i â€œmemory leakâ€.
âœ… ThÃ­ch há»£p vá»›i embedded nhá» (vÃ¬ predict Ä‘Æ°á»£c dung lÆ°á»£ng RAM cáº§n).
**NhÆ°á»£c Ä‘iá»ƒm:**
âŒ KhÃ´ng linh hoáº¡t (pháº£i biáº¿t kÃ­ch thÆ°á»›c trÆ°á»›c).
âŒ CÃ³ thá»ƒ lÃ£ng phÃ­ RAM náº¿u khai bÃ¡o máº£ng lá»›n mÃ  khÃ´ng dÃ¹ng háº¿t.

### Cáº¥p phÃ¡t Ä‘á»™ng (Dynamic Allocation)
**Äáº·c Ä‘iá»ƒm:**
- Bá»™ nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t khi chÆ°Æ¡ng trÃ¬nh cháº¡y (runtime).
- Sá»­ dá»¥ng vÃ¹ng nhá»› heap.
- Do láº­p trÃ¬nh viÃªn quáº£n lÃ½ (táº¡o vÃ  giáº£i phÃ³ng thá»§ cÃ´ng).

**Æ¯u Ä‘iá»ƒm:**
âœ… Linh hoáº¡t, cÃ³ thá»ƒ táº¡o vÃ¹ng nhá»› tÃ¹y theo tÃ¬nh huá»‘ng thá»±c táº¿.
âœ… Tiáº¿t kiá»‡m RAM khi chá»‰ cáº¥p phÃ¡t khi cáº§n.
âœ… ThÃ­ch há»£p cho cáº¥u trÃºc dá»¯ liá»‡u `linked list, queue, treeâ€¦`.
**NhÆ°á»£c Ä‘iá»ƒm:**
âŒ Tá»‘n thá»i gian hÆ¡n (malloc/free cháº­m hÆ¡n khai bÃ¡o tÄ©nh).
âŒ Dá»… bá»‹ memory leak náº¿u quÃªn free().
âŒ Trong embedded nhá», heap cÃ³ thá»ƒ ráº¥t háº¡n cháº¿ â†’ nguy cÆ¡ fragmentation (bá»‹ phÃ¢n máº£nh, khÃ´ng cáº¥p phÃ¡t Ä‘Æ°á»£c ná»¯a).