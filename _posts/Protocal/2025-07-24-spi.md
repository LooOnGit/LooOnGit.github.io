---
title: "SPI"
date: 2025-07-24 22:41:00 +0800
categories: [Protocol]
tags: [Protocol]
---

# 🔄 SPI (Serial Peripheral Interface)

## 📝 Tổng quan

SPI (Serial Peripheral Interface) là một chuẩn giao tiếp nối tiếp đồng bộ, thường được sử dụng để truyền dữ liệu giữa vi điều khiển và các thiết bị ngoại vi như cảm biến, bộ nhớ, màn hình, v.v. SPI sử dụng bốn đường tín hiệu chính:

![alt text](/assets/Protocol/SPI_Connect.png)

- 📤 **MOSI (Master Out Slave In)**: Dữ liệu từ Master đến Slave
- 📥 **MISO (Master In Slave Out)**: Dữ liệu từ Slave đến Master
- ⏰ **SCK (Serial Clock)**: Xung nhịp do Master tạo ra
- 🎯 **SS/CS (Slave Select/Chip Select)**: Chọn thiết bị Slave

> SPI có tốc độ truyền dữ liệu cao, cấu trúc đơn giản và dễ triển khai trong các ứng dụng nhúng.

## 🔄 Cách hoạt động của SPI
![alt text](/assets/Protocol/spi_transmit_recv.png)
Trong ví dụ trên, ta có thể thấy:

1. ⏰ **Xung clock (SCK)**:
- Cho biết khi nào nên lấy mẫu dữ liệu.
- Khi nào đọc mức điện áp.
- Mỗi lần truyền xong một bit dữ liệu.
- Tín hiệu clock có thể ở trạng thái idle mức thấp (idle low) hoặc mức cao (idle high).
- Dữ liệu có thể được lấy mẫu ở cạnh lên hoặc cạnh xuống của xung clock.

2. 🎯 **Slave Select (SS/CS)**:
   - Kéo xuống mức thấp khi bắt đầu truyền
   - Giữ mức thấp trong suốt quá trình truyền
   - Kéo lên mức cao khi kết thúc

3. 🎯 **MOSI**:
- Sử dụng để truyền dữ liệu từ master về slave, dữ liệu thường được gửi theo đơn vị byte (LSB hoặc MSB trước).
- Có thể gửi nhiều byte liên tục.

2. 🎯 **MISO**:
- Dùng để gửi dữ liệu từ Slave đến Master.
- 
### 🔍 Đặc điểm quan trọng

1. 🔁 **Truyền song song hai chiều**:
   - MOSI và MISO hoạt động đồng thời
   - Trong một chu kỳ truyền 8 bit:
     * Master gửi 1 byte qua MOSI
     * Đồng thời nhận 1 byte từ MISO
---

### 🔄 SPI MODE

SPI có 4 chế độ hoạt động (MODE) khác nhau, được xác định bởi hai tham số:
- 🔵 **CPOL (Clock Polarity)**: Xác định mức logic của chân SCK khi không truyền dữ liệu
  - CPOL = 0: SCK ở mức thấp khi nghỉ
  - CPOL = 1: SCK ở mức cao khi nghỉ
- 🔴 **CPHA (Clock Phase)**: Xác định thời điểm lấy mẫu dữ liệu
  - CPHA = 0: Lấy mẫu tại cạnh đầu tiên của SCK
  - CPHA = 1: Lấy mẫu tại cạnh thứ hai của SCK

#### Bảng các chế độ SPI:

| Mode | CPOL | CPHA | Trạng thái nghỉ SCK | Cạnh lấy mẫu |
|------|------|------|---------------------|--------------|
| 0    | 0    | 0    | Mức thấp           | Cạnh lên     |
| 1    | 0    | 1    | Mức thấp           | Cạnh xuống   |
| 2    | 1    | 0    | Mức cao            | Cạnh xuống   |
| 3    | 1    | 1    | Mức cao            | Cạnh lên     |

![alt text](/assets/Protocol/spi_mode.png)
