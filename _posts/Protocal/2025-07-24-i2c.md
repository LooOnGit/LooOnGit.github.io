---
title: "I2C"
date: 2025-07-24 22:0:00 +0800
categories: [Protocol]
tags: [Protocol]
---

## ğŸ“¡ LÃ½ Thuyáº¿t I2C

### ğŸŒŸ Äáº·c Äiá»ƒm ChÃ­nh
- **Giao thá»©c**: Truyá»n thÃ´ng ná»‘i tiáº¿p Ä‘á»“ng bá»™
- **PhÃ¡t triá»ƒn**: Philips Semiconductor (NXP), 1982
- **á»¨ng dá»¥ng**: Truyá»n thÃ´ng khoáº£ng cÃ¡ch ngáº¯n
- **TÃ­n hiá»‡u**: SCL (Clock) vÃ  SDA (Data)
![alt text](/assets/Protocol/i2c_connect.png)

### ğŸš€ Æ¯u Äiá»ƒm
- âœ¨ Thiáº¿t káº¿ pháº§n cá»©ng Ä‘Æ¡n giáº£n
- ğŸ”— Há»— trá»£ nhiá»u thiáº¿t bá»‹ (multi-slave)
- ğŸ”„ Truyá»n thÃ´ng hai chiá»u
- âœ… CÃ³ cÆ¡ cháº¿ kiá»ƒm tra lá»—i

### âš¡ Tá»‘c Äá»™ Truyá»n

| Cháº¿ Ä‘á»™ | Tá»‘c Ä‘á»™ | á»¨ng dá»¥ng |
|:------:|:------:|:--------:|
| Standard | 100kHz | ThÃ´ng thÆ°á»ng |
| Fast | 400kHz | Tá»‘c Ä‘á»™ cao |
| Fast Plus | 1MHz | Hiá»‡u nÄƒng cao |

### ğŸ”„ Cáº¥u TrÃºc Frame vÃ  Timing

#### 3.1 Cáº¥u TrÃºc Frame CÆ¡ Báº£n
![alt text](/assets/Protocol/i2c_dataframe.png)

![alt text](/assets/Protocol/i2c_dataframe2.png)

#### 3.2 Chi Tiáº¿t Tá»«ng Pháº§n

1. **Äiá»u Kiá»‡n START (S)**
   - **Tráº¡ng thÃ¡i Idle**:
     - á» tráº¡ng thÃ¡i nghá»‰, cáº£ SDA vÃ  SCL Ä‘á»u á»Ÿ má»©c HIGH
     - Bus Ä‘ang á»Ÿ tráº¡ng thÃ¡i tá»± do, sáºµn sÃ ng cho truyá»n thÃ´ng
   
   - **QuÃ¡ trÃ¬nh táº¡o Ä‘iá»u kiá»‡n START**:
     - BÆ°á»›c 1: Master kÃ©o SDA xuá»‘ng LOW (trong khi SCL váº«n HIGH)
     - BÆ°á»›c 2: Master kÃ©o SCL xuá»‘ng LOW
     - QuÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c gá»i lÃ  "chiáº¿m giá»¯ bus" (claiming the bus)
   
   - **Ã nghÄ©a**:
     - ÄÃ¡nh dáº¥u báº¯t Ä‘áº§u truyá»n thÃ´ng
     - Node thá»±c hiá»‡n Ä‘iá»u kiá»‡n START trá»Ÿ thÃ nh Master
     - NgÄƒn cháº·n cÃ¡c node khÃ¡c chiáº¿m quyá»n Ä‘iá»u khiá»ƒn bus
     - Giáº£m thiá»ƒu nguy cÆ¡ xung Ä‘á»™t trÃªn bus
   
   - **Sau Ä‘iá»u kiá»‡n START**:
     - Master cÃ³ quyá»n Ä‘iá»u khiá»ƒn Ä‘á»™c quyá»n bus
     - Master báº¯t Ä‘áº§u táº¡o xung clock trÃªn Ä‘Æ°á»ng SCL
     - CÃ¡c node khÃ¡c pháº£i Ä‘á»£i Ä‘áº¿n khi cÃ³ Ä‘iá»u kiá»‡n STOP

2. **Äá»‹a Chá»‰ Slave (7 bit)**
   - **YÃªu Cáº§u CÆ¡ Báº£n**:
     - Má»—i thiáº¿t bá»‹ trÃªn bus I2C pháº£i cÃ³ Ä‘á»‹a chá»‰ duy nháº¥t
     - Äá»‹a chá»‰ Ä‘Æ°á»£c cá»‘ Ä‘á»‹nh vÃ  khÃ´ng thay Ä‘á»•i trong quÃ¡ trÃ¬nh hoáº¡t Ä‘á»™ng
     - Truyá»n tá»« MSB (A6) Ä‘áº¿n LSB (A0)

   - **Äá»‹nh Dáº¡ng Äá»‹a Chá»‰**:
     - Äá»‹a chá»‰ 7-bit lÃ  chuáº©n phá»• biáº¿n nháº¥t: `A6 A5 A4 A3 A2 A1 A0`
     - Äá»‹a chá»‰ 10-bit cÅ©ng Ä‘Æ°á»£c há»— trá»£ nhÆ°ng Ã­t phá»• biáº¿n hÆ¡n
     - Bit thá»© 8 (R/W) Ä‘Æ°á»£c thÃªm vÃ o sau Ä‘á»‹a chá»‰ Ä‘á»ƒ chá»‰ Ä‘á»‹nh hÆ°á»›ng truyá»n.
     - Truyá»n tá»« MSB â†’ LSB (MSB first bit)

   - **Sá»‘ LÆ°á»£ng Thiáº¿t Bá»‹ Tá»‘i Äa**:
     - Äá»‹a chá»‰ 7-bit: 128 thiáº¿t bá»‹ (2^7)
     - Äá»‹a chá»‰ 10-bit: 1024 thiáº¿t bá»‹ (2^10)
     - Giá»›i háº¡n thá»±c táº¿ thÆ°á»ng do Ä‘iá»‡n dung bus (400pF)

3. **Bit Read/Write (R/W)**
   - Bit thá»© 8 sau Ä‘á»‹a chá»‰
   - 0: Master â†’ Slave (Write)
   - 1: Slave â†’ Master (Read)

4. **Bit ACK/NACK**
   - Sau má»—i byte (8 bit)
   - Do bÃªn nháº­n gá»­i (Receiver)
   - ACK = 0: XÃ¡c nháº­n Ä‘Ã£ nháº­n
   - NACK = 1: KhÃ´ng xÃ¡c nháº­n/Káº¿t thÃºc Ä‘á»c

# Multiple data bytesS

![alt text](assets/Protocol/multi_i2c.png)

### ğŸ•’ Má»‘i Quan Há»‡ Timing giá»¯a SDA vÃ  SCL

Äá»ƒ Ä‘áº£m báº£o truyá»n thÃ´ng I2C hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c, má»‘i quan há»‡ timing giá»¯a SDA vÃ  SCL cáº§n tuÃ¢n thá»§ cÃ¡c quy táº¯c sau:

1. **Quy Táº¯c CÆ¡ Báº£n**:
   - SDA khÃ´ng Ä‘Æ°á»£c thay Ä‘á»•i khi SCL á»Ÿ má»©c cao (HIGH)
   - SDA chá»‰ Ä‘Æ°á»£c phÃ©p thay Ä‘á»•i khi SCL á»Ÿ má»©c tháº¥p (LOW)
   - Ngoáº¡i lá»‡: Ä‘iá»u kiá»‡n START vÃ  STOP

2. **Trong QuÃ¡ TrÃ¬nh Truyá»n Dá»¯ Liá»‡u**:
    ![alt text](/assets/Protocol/timing_sda_scl.png)

   - SDA chá»‰ thay Ä‘á»•i khi SCL = LOW
   - SDA pháº£i giá»¯ á»•n Ä‘á»‹nh khi SCL = HIGH
   - Dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y máº«u táº¡i cáº¡nh lÃªn cá»§a SCL

3. **Äiá»u Kiá»‡n START/STOP**:
   ![alt text](/assets/Protocol/i2c_start_stop.png)
   - START: SDA chuyá»ƒn tá»« HIGH â†’ LOW khi SCL = HIGH
   - STOP: SDA chuyá»ƒn tá»« LOW â†’ HIGH khi SCL = HIGH

4. **Timing Diagram Chi Tiáº¿t**:
   ```
         Start         Data           Stop
         |            |              |
   SDA â€¾â€¾â€¾\__________|â€¾â€¾â€¾â€¾â€¾â€¾\______/â€¾â€¾â€¾
            \         |       \    /
   SCL â€¾â€¾â€¾â€¾â€¾â€¾\___/â€¾â€¾â€¾\___/â€¾â€¾â€¾\__/â€¾â€¾â€¾â€¾
   ```

### âš¡ CÃ¡c Cháº¿ Äá»™ Tá»‘c Äá»™ (Speed Modes)

I2C cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng á»Ÿ nhiá»u má»©c tá»‘c Ä‘á»™ khÃ¡c nhau, Ä‘Æ°á»£c gá»i lÃ  cÃ¡c "mode". Má»—i mode cÃ³ Ä‘áº·c Ä‘iá»ƒm vÃ  á»©ng dá»¥ng riÃªng.

#### 1. CÃ¡c Mode CÆ¡ Báº£n

| Cháº¿ Äá»™ | Tá»‘c Äá»™ | Äáº·c Äiá»ƒm |
|:-------|:-------|:---------|
| Standard Mode | 100 kbps | Mode chuáº©n, phá»• biáº¿n nháº¥t |
| Fast Mode | 400 kbps | TÆ°Æ¡ng thÃ­ch ngÆ°á»£c vá»›i Standard |
| Fast Mode Plus | 1 Mbps | Cáº§n Ä‘iá»‡n trá»Ÿ pull-up thÃ­ch há»£p |

#### 2. CÃ¡c Mode Tá»‘c Äá»™ Cao

| Cháº¿ Äá»™ | Tá»‘c Äá»™ | Äáº·c Äiá»ƒm Äáº·c Biá»‡t |
|:-------|:-------|:------------------|
| High Speed Mode | 3.4 Mbps | - TÆ°Æ¡ng thÃ­ch ngÆ°á»£c vá»›i mode cháº­m hÆ¡n<br>- Cáº§n chuá»—i khá»Ÿi táº¡o Ä‘áº·c biá»‡t Ä‘á»ƒ chuyá»ƒn sang HS<br>- Äiá»‡n trá»Ÿ pull-up riÃªng cho HS |
| Ultra Fast Mode | 5 Mbps | - Chá»‰ há»— trá»£ truyá»n má»™t chiá»u (write-only)<br>- YÃªu cáº§u sá»­a Ä‘á»•i giao thá»©c vÃ  frame<br>- KhÃ´ng tÆ°Æ¡ng thÃ­ch vá»›i cÃ¡c mode khÃ¡c |

### "Open drain"
 - NgÃµ ra "open-drain" chá»‰ gá»“m má»™t transistor MOSFET cÃ³ chÃ¢n drain (D) ná»‘i ra ngoÃ i, chÃ¢n source (S) ná»‘i GND. Khi transistor ON, nÃ³ kÃ©o tÃ­n hiá»‡u xuá»‘ng GND. Khi transistor OFF, ngÃµ ra trá»Ÿ thÃ nh tráº¡ng thÃ¡i "há»Ÿ máº¡ch" (khÃ´ng ná»‘i gÃ¬), nÃªn Ä‘á»ƒ cÃ³ má»©c HIGH, ta cáº§n má»™t Ä‘iá»‡n trá»Ÿ kÃ©o lÃªn (pull-up) Ä‘áº¿n nguá»“n (Vcc).

 ### CMOS
 - CMOS lÃ  viáº¿t táº¯t cá»§a Complementary Metal-Oxide-Semiconductor â€“ tá»©c lÃ  BÃ¡n dáº«n Oxide kim loáº¡i bÃ¹. ÄÃ¢y lÃ  má»™t cÃ´ng nghá»‡ cháº¿ táº¡o vi máº¡ch phá»• biáº¿n, Ä‘áº·c biá»‡t trong:

**CMOS sá»­ dá»¥ng hai loáº¡i transistor MOSFET:**
- NMOS (n-type MOSFET)
- PMOS (p-type MOSFET)