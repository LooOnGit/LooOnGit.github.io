---
title: "SPI"
date: 2026-01-14 20:53:06 +0700
categories: [Bare Metal STM32]
tags: [Bare Metal STM32]
---

# SPI

## Overview of  the SPI protocol
SPI là chuẩn giao tiếp đồng bộ (synchronous) được phát triển bởi Motorola. Khác với UART thì SPI có chân sign để đồng bộ data giữa các devices. Nó được thiết kế giao tiếp khoảng cách ngắn (thường ngắn hơn 30 cm).
### What is SPI?
- **Full-duplex communication**: SPI support đồng thời gửi và nhận dữ liệu.
- **High speed**: SPI có thể hoạt động tốc độ cao hơn so với các protocol như I2C và UART.
- **Master-slave architecture**: Một master device điều khiển giao tiếp, trong khi 1 hoặc nhiều slave devices phản hồi.
- **Flexible data lenght**: Có thể xử lý nhiều độ dài data, thông thường 8bit, nhưng không giới hạn.
### Key feature of SPI
- **Master In Slave Out (MISO)**: Còn được gọi là **Serial Data Out (SDO)** or **Data Out (DOUT)**, mang data từ slave đến master.
- **Master Out Slave In (MOSI)**: Còn được gọi là **Serial Data In (SDI)** or **Data In (DIN)**, mang data từ master đến slave.
- **Serial Clock (SCK)**: Cùng được xem như **SCLK**(hoặc cơ bản CLK), điều này clock signal để đồng bộ data gửi giữa master và slave.
- **Slave Select (SS)**: Cũng được gọi là **Chip Select (CS)** hoặc **Not Slave Select (NSS)**, sử dụng bằng master để chọn device để giao tiếp.


![SPI](/assets/Bare_Metal_STM32/SPI/image.png)


Khi nhiều slave được kết nối chung trên một bus SPI, việc quản lý đường MISO là cực kỳ quan trọng để tránh lỗi truyền thông. Vì tất cả các slave đều dùng chung đường này, các slave không được chọn có thể gây nhiễu tín hiệu của slave đang được chọn nếu không được kiểm soát đúng cách.


Để ngăn chặn các vấn đề này, người ta sử dụng nhiều kỹ thuật khác nhau. Một phương pháp phổ biến là tri-state buffering, trong đó chân MISO của mỗi slave sẽ chuyển sang trạng thái trở kháng cao (high-Z) khi chân CS của nó không được kích hoạt, tức là nó bị “ngắt” khỏi bus. Điều này đảm bảo rằng chỉ slave đang được chọn mới điều khiển đường MISO, tránh hiện tượng xung đột bus.

Một cách tiếp cận khác là cấu hình open-drain với điện trở kéo lên (pull-up resistor). Khi đó, đường MISO sẽ ở trạng thái “thả nổi” (high-Z) khi truyền bit 1, và chỉ bị kéo xuống mức thấp bởi slave đang được chọn khi truyền bit 0. Cách này giúp giảm nguy cơ xung đột, nhưng có thể làm tốc độ truyền chậm hơn do thời gian trễ của điện trở kéo lên.
### The SPI interface

### How SPI works
### CPHA and CPOL
### Data modes
### SPI speed
## The STM32F4 SPI peripheral
### Key features
### Key SPI register

## Developing the SPI driver

