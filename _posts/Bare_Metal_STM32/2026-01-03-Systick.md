---
title: "System Tick (SysTick) Timer"
date: 2026-01-03 04:09:52 +0700
categories: [Bare Metal STM32]
tags: [Bare Metal STM32]
---

# System Tick (SysTick) Timer
## Introduction to the SysTick timer
### Overview of the SysTick timer
Tính năng chính của **Systick timer** bao gồm như sau:
- **24-bit Reloadable Counter**: Giảm từ 1 giá trị đến 0, sau đó tự động reload để cung cấp một thời gian hoạt động liên tục.
- **Core Integration**: Thành phần core, nó yêu cầu cấu hình tối thiểu và cung cấp interrupt handler độ trễ thấp.
- **Configuration Flexibility**: SysTick có thể hoạt động từ **core clock** hoặc một **external refer clock**, cung cấp tinh linh hoạt trong **độ chính xác về thời gian** và **tiếp kiệm năng lượng**.
- **Interrupt Generation**: Khi **counter** giảm xuống 0, nó tạo ra **trigger interrupt**.

**SystTick timer** thường dùng trong 3 trường hợp:
- **OS Tick Generation**:Trong RTOS, **SysTick** thì thường được sử dụng để tạo ra **system tick interrupt**, ngắt này điều khiển **OS scheduler**.
- **Periodic Interrupt Generation**: Nó có thể sử dụng trigger cho các task lặp lại, chẳng hạn kiểm tra lấy mẫu và giao tiếp với sersor.
- **Time Delay Function**: **SysTick** có thể cung cấp delay có độ chính xác cho các chức năng thời gian.
### SysTick timer registers
Bao gồm 4 register chủ yếu:
- SysTick Control and Status Register (SYST_CSR)
- SysTick Reload Value Register (SYST_RVR)
- SysTick Current Value Register (SYST_CVR)
- SysTick Calibration Value Register (SYST_CALIB)
#### The SysTick Control and Status Register (SYST_CSR)
Trong trang **247** của tài liệu **cortex-m4 generic user guide**có nói về thanh ghi này. Thanh ghi cung cấp thông tin trạng thái hoạt động và hoạt động của **SysTick timer**.


![SysTick CSR](/assets/Bare_Metal_STM32/SysTick/image.png)


#### The SysTick Reload Value Register (SYST_RVR)
Vì **SysTick timer** thì có **24-bit**, nên có thể bất cứ giá trị nào từ **0x00000001** đến **0x00FFFFFF**.


Để tính giá trị **RELOAD** dựa trên giá trị mong muốn, chúng ta nhận diện giá trị **clock cycle** cho chu kì mong muốn, và sau đó **trừ 1** số này để set cho **RELOAD Value**.


**Example**: Nếu **core clock** là **16MHz**, và chung tôi muốn Systick timer để có trigger **1ms**, **RELOAD value** tính như sau:
- Tính số **clock cycle** trong **1ms**:
```bash
Clock cycles = 16000000 cycles / second * 0.001 second = 16000 cycles
```
**Note**: 1ms = 0.001 second
- Trừ 1 từ tính số clock cycles:
```bash
RELOAD = 16000 - 1 = 15999 bởi vì đếm từ 0 đến 15999 sẽ được 16000 ticks.
```


![SysTick CSR](/assets/Bare_Metal_STM32/SysTick/image2.png)
#### The SysTick Current Value Register
SysTick Current Value Register (SYST_CVR) giữ giá trị hiện tại của SysTick timer. Có thể sử dụng register này dể monitor countdown và reset counter khi cần thiết.


![SysTick CVR](/assets/Bare_Metal_STM32/SysTick/image3.png)
#### The SysTick Calibration Value Register
Systick Calibration Value Register (SYST_CALIB). Register này cung cấp thông tin của Systick timer.


![SysTick Calib](/assets/Bare_Metal_STM32/SysTick/image34.png)
## Developing a driver for the SysTick timer 
- **Step1**: Set clock cycle per millisecond
- **Step2**: Clear current value register 
- **Step3**: Select clock source
- **Step4**: Enable SysTick timer
- **Step5**: Disable SysTick timer
```c
void systickMsecDelay(uint32_t delay)
{
    /* Load number of clock cycles per millisecond*/
    SysTick->LOAD = ONE_MSEC_TICKS - 1;
    /*Clear systick current value register*/
    SysTick->VAL = 0;
    /*Select internal clock source*/
    SysTick->CTRL |= CTRL_CLCKSRC;
    /*Enable systick*/
    SysTick->CTRL |= CTRL_ENABLE;
    for (uint32_t i = 0; i < delay; i++)
    {
        /*Wait until the COUNTFLAG is set*/
        while ((SysTick->CTRL & CTRL_COUNTFLAG) == 0)
        {
            /*Do nothing*/
        }
    }
    /*Disable systick*/
    SysTick->CTRL &= ~CTRL_ENABLE;
}
```