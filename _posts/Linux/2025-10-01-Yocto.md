---
title: "Yocto"
date: 2025-10-01 20:25:24 +0800
categories: [Linux]
tags: [Linux]
---

# Yocto Learning Roadmap

## ğŸ“Œ Giá»›i thiá»‡u
TÃ i liá»‡u nÃ y Ä‘Æ°á»£c viáº¿t Ä‘á»ƒ tá»•ng há»£p lá»™ trÃ¬nh há»c vÃ  thá»±c hÃ nh vá»›i **Yocto Project** â€“ má»™t framework máº¡nh máº½ Ä‘á»ƒ build Linux nhÃºng.  
Má»¥c tiÃªu: tá»« kiáº¿n thá»©c ná»n táº£ng â†’ lÃ m chá»§ Yocto â†’ build image cho thiáº¿t bá»‹ nhÃºng thá»±c táº¿.

---

## ğŸ§© 1. Ná»n táº£ng trÆ°á»›c khi há»c Yocto
### 1. Linux cÆ¡ báº£n
#### 1.1 `ls` (liá»‡t kÃª file/ thÆ° má»¥c)
```bash
ls /
```
Result:
```bash
bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  
root  run  sbin  srv  sys  tmp  usr  var
```
- **bin**: Chá»©a cÃ¡c lá»‡nh cÆ¡ báº£n cho ngÆ°á»i dÃ¹ng
**VD**: `ls`, `cp`, `mv`, `cat`, `echo`.

- **sbin**: Chá»©c cÃ¡c lá»‡nh quáº£n trá»‹ há»‡ thá»‘ng, thÆ°Æ¡ng cáº§n quyá»n root.
**VD**: `ifconfig`, `reboot`, `mount`.

- **lib vÃ  lib64**: Chá»©a thÆ° viá»‡n há»‡ thá»‘ng cáº§n thiáº¿t cho chÆ°Æ¡ng trÃ¬nh trong `/bin` vÃ  `/sbin`.
**VD**: ThÆ° viá»‡n `.so` (shared project)
`lib64` dÃ nh riÃªng cho há»‡ thá»‘ng 64-bit.

**boot**: Chá»©a file khá»Ÿi Ä‘á»™ng há»‡ thá»‘ng: kernel (vmlinuz), initrd vÃ  bootloader (GRUB).

**dev**: Äáº¡i diá»‡n cho thiáº¿t bá»‹ pháº§n cá»©ng dÆ°á»›i dáº¡ng file.
**VD**: `/dev/sda`(á»• cá»©ng), `/dev/ttyUSB0` (serial), `/dev/null`.

**proc**: ThÆ° má»¥c áº£o, chá»©a thÃ´ng tin vá» tiáº¿n trÃ¬nh vÃ  kernel.
**VD**: `proc/cpuinfo`, `/proc/meminfo`, `/proc/[pid]`.

**sys**: Cung cáº¥p thÃ´ng tin vá» thiáº¿t bá»‹ vÃ  driver. DÃ¹ng nhiá»u trong debug kernel.

**home**: Chá»©a thÆ° má»¥c cÃ¡ nhÃ¢n cá»§a tá»«ng user.
**VD**: `/home/user1`, `/home/user2`.

**root**: ThÆ° má»¥c cÃ¡ nhÃ¢n cá»§a tÃ i khoáº£n root (superuser).

**tmp**: Chá»©a file táº¡m thá»i. Bá»‹ xÃ³a khi khá»Ÿi Ä‘á»™ng láº¡i.

**media**: ThÆ° má»¥c mount tá»± Ä‘á»™ng cho thiáº¿t bá»‹ ngoÃ i.
**VD**: Khi cáº¯m USB vÃ o sáº½ hiá»‡n `/media/username/USB_DRIVE`.

**etc**: Chá»©a file cáº¥u hÃ¬nh há»‡ thá»‘ng.
**VD**: `/etc/passwd`, `/etc/fstab`, `/etc/hostname`.

**srv**: Chá»©a dá»¯ liá»‡u cho cÃ¡c dá»‹ch vá»¥ server.
**VD**: `/srv/ftp`, `/srv/www`.

**run**: LÆ°u thÃ´ng tin runtime (PID file, socket, lock). ÄÆ°á»£c reset khi khá»Ÿi Ä‘á»™ng láº¡i.

**usr**: Chá»© pháº§n má»m vÃ  thÆ° viá»‡n cho ngÆ°á»i dÃ¹ng. BÃªn trong cÃ³ `/usb/bin` (lá»‡nh cá»§a user), `/usr/sbin` (lá»‡nh quáº£n trá»‹ user), `/user/lib` (thÆ° viá»‡n), `/usr/share` (dá»¯ liá»‡u dÃ¹ng chung, vÃ­ dá»¥ tÃ i liá»‡u, icons).

**var**: Chá»©a dá»¯ liá»‡u thay Ä‘á»•i thÆ°á»ng xuyÃªn.
**VD**: `/var/log` (log há»‡ thá»‘ng), `/var/lib` (database táº¡m), `/var/cache`.

#### 1.2 `pwd` (in thÆ° má»¥c hiá»‡n táº¡i)
```bash
pwd
```
Result:

```bash
/home/username
```

#### 1.3 `cd` (di chuyá»ƒn thÆ° má»¥c)
```bash
cd /etc
pwd
```
Result:
```bash
/etc
```

#### 1.4 `mkdir` (táº¡o thÆ° má»¥c)
```bash
mkdir test_dir
ls
```
Result:
```bash
mkdir test_dir
ls
```

#### 1.5 `touch` (táº¡o file rá»—ng)
```bash
touch test.txt
ls
```

#### 1.6 `cp` (copy file)

## ğŸš€ 2. Báº¯t Ä‘áº§u vá»›i Yocto
`Yocto Project` giÃºp giáº£i quyáº¿t má»™t sá»‘ váº¥n Ä‘á» chÃ­nh trong phÃ¡t triá»ƒn há»‡ Ä‘iá»u hÃ nh cho thiáº¿t bá»‹ nhÃºng:
- **TÃ­nh linh hoáº¡t:** Yocto cho phÃ©p tÃ¹y chá»‰nh tá»« bootloader, kernel Ä‘áº¿n user space, tá»« Ä‘Ã³ dá»… dÃ ng táº¡o ra há»‡ Ä‘iá»u hÃ nh phÃ¹ há»£p cho cÃ¡c thiáº¿t bá»‹ cÃ³ yÃªu cáº§u pháº§n cá»©ng riÃªng biá»‡t.
- **TÃ¡i sá»­ dá»¥ng mÃ£ nguá»“n:** Yocto há»— trá»£ viá»‡c tÃ¡i sá»­ dá»¥ng cÃ¡c thÃ nh pháº§n tá»« cÃ¡c dá»± Ã¡n mÃ£ nguá»“n má»Ÿ, giÃºp tiáº¿t kiá»‡m thá»i gian vÃ  chi phÃ­ phÃ¡t triá»ƒn.
- **Kháº£ nÄƒng mÃ´ Ä‘un hÃ³a:** Vá»›i cÃ¡c meta-layer vÃ  recipe, Yocto giÃºp quáº£n lÃ½, má»Ÿ rá»™ng vÃ  phÃ¡t triá»ƒn há»‡ thá»‘ng má»™t cÃ¡ch hiá»‡u quáº£, tÃ¡ch biá»‡t cÃ¡c thÃ nh pháº§n theo tá»«ng lá»›p chá»©c nÄƒng.
- **Kháº£ nÄƒng tÃ­ch há»£p CI/CD:** Yocto cÃ³ thá»ƒ tÃ­ch há»£p vá»›i cÃ¡c há»‡ thá»‘ng Continuous Integration/Continuous Deployment (CI/CD) Ä‘á»ƒ giÃºp tá»± Ä‘á»™ng hÃ³a vÃ  kiá»ƒm tra quÃ¡ trÃ¬nh xÃ¢y dá»±ng há»‡ Ä‘iá»u hÃ nh.

CÃ¡c dá»± Ã¡n vÃ  cÃ´ng cá»¥ chÃ­nh cáº¥u thÃ nh nÃªn sinh thÃ¡i xÃ¢y dá»±ng Yocto Project bao gá»“m: Poky, BitBake vÃ  OpenEmbedded Core.
### ğŸ—ï¸ Poky
LÃ  báº£n pháº§n phá»‘i máº·c Ä‘á»‹nh cá»§a Yocto Project, nÃ³ dÃ¹ng cÃ´ng nghá»‡ há»‡ thá»‘ng xÃ¢y dá»«ng OpenEmbedded. NÃ³ bao gá»“m cÃ¡c tools, file cáº¥u hÃ¬nh vÃ  recipe data (nhÆ° lÃ  metadata). Poky Ä‘á»™c láº­p vá»›i ná»n táº£ng vÃ  thá»±c iá»‡n biÃªn dá»‹ch chÃ©o (cross-compiling) báº±ng cÃ´ng cá»¥ Bitbake, OpenEmbedded Core vÃ  metadata máº·c Ä‘á»‹nh.

LÃ  1 git repository Ä‘Æ°á»£c táº­p há»£p tá»« nhiá»u git repositories: bitbake, openembedded-core, yocto-docs vÃ  meta-yocto.

![alt text](/assets/Linux/Yocto/image-15.png)

poky cÅ©ng lÃ  báº£n reference Distro (distribution) do Yocto cung cáº¥p.
Meta-poky lÃ  layer cung cáº¥p báº£n phÃ¢n phá»‘i tham chiáº¿u poky.

##### ğŸ”¨ BitBake
LÃ  1 task scheduler vÃ  thá»±c thi há»‡ thá»‘ng (execution system). NÃ³ Ä‘Æ°á»£c mÃ´ táº£ giá»‘ng `GNU Make`.
NÃ³ phÃ¢n tÃ­ch text file biáº¿t cÃ¡i nÃ³ build cÃ¡i nÃ o vÃ  nhÆ° tháº¿ nÃ o. NÃ³ Ä‘Æ°á»£c viáº¿t báº±ng Python (Cáº§n Python 3). Bitbake lÃ  cÃ´ng cá»¥ chÃ­nh cá»§a Yocto, Recipe lÃ  loáº¡i file chÃ­nh mÃ  BitBake Ä‘á»c Ä‘uÃ´i (.bb).

HÃ¬nh mÃ´ táº£ dependency giá»¯a cÃ¡c recipe:

![alt text](/assets/Linux/Yocto/image-16.png)

### ğŸ¯ OpenEmbedded Core
OpenEmbedded lÃ  framework cÆ¡ báº£n mÃ  Yocto Project sá»­ dá»¥ng. OpenEmbedded cung cáº¥p mÃ´i trÆ°á»ng vÃ  cáº¥u trÃºc Ä‘á»ƒ táº¡o ra há»‡ Ä‘iá»u hÃ nh nhÃºng, cho phÃ©p ngÆ°á»i dÃ¹ng dá»… dÃ ng xÃ¢y dá»±ng vÃ  quáº£n lÃ½ cÃ¡c thÃ nh pháº§n pháº§n má»m trong há»‡ Ä‘iá»u hÃ nh cá»§a há».

LÃ  core layer, táº¥t cáº£ cÃ¡c layer Ä‘Æ°á»£c xÃ¢y dá»±ng tá»« openembedded-core.

`CÃ´ng cá»¥:` OpenEmbedded cung cáº¥p cÃ¡c meta-layers, recipes, vÃ  cÃ¡c cÃ´ng cá»¥ bá»• sung giÃºp Yocto Project linh hoáº¡t vÃ  máº¡nh máº½ hÆ¡n.

### ğŸ“„ Metadata
Input cá»§a `bitbake` thÃ¬ gá»i lÃ  metadata. Metadata bao gá»“m configuration files, recipes, classes vÃ  include files. Metadata Ä‘Æ°á»£c tá»• chá»©c thÃ nh nhiá»u lá»›p, Ä‘a dáº¡ng nhá»¯ng thÃ nh pháº§n.
- Má»—i layer Ä‘Æ°á»£c set gá»“m nhá»¯ng recipes, configuration files phá»¥c vá»¥ chung má»¥c Ä‘Ã­ch.
#### Config File (`.conf`)
Äá»‹nh nghÄ©a ná»™i dung toÃ n cá»¥c (global content) Ä‘á»ƒ cung cáº¥p thÃ´ng tin vÃ  cáº¥u hÃ¬nh cÃ¡ch cÃ¡c **recipes** vÃ  lá»›p **classes** hoáº¡t Ä‘á»™ng. 
**VÃ­ dá»¥:** Ä‘iá»ƒn hÃ¬nh lÃ  tá»‡p mÃ¡y (machine file), mÃ´ táº£ cÃ¡c cÃ i Ä‘áº·t pháº§n cá»©ng.
- `local.conf:` Chá»©a cÃ¡c thiáº¿t láº­p liÃªn quan Ä‘áº¿n mÃ¡y Ä‘Ã­ch, sá»‘ luá»“ng CPU Ä‘á»ƒ build, v.v.
- `bblayers.conf:` XÃ¡c Ä‘á»‹nh cÃ¡c layer mÃ  BitBake sáº½ sá»­ dá»¥ng trong quÃ¡ trÃ¬nh build.

#### Recipe (`.bb` vÃ  `.bbappend`)
**Recipe** lÃ  cÃ¡c tá»‡p tin mÃ´ táº£ cÃ¡ch biÃªn dá»‹ch vÃ  cÃ i Ä‘áº·t má»™t gÃ³i pháº§n má»m trong Yocto Project. Má»—i recipe chá»©a cÃ¡c hÆ°á»›ng dáº«n nhÆ°:
- Nguá»“n mÃ£ nguá»“n (SRC_URI).
- CÃ¡ch biÃªn dá»‹ch (do_compile).
- CÃ¡ch cÃ i Ä‘áº·t (do_install).
CÃ¡c recipe cÃ³ pháº§n má»Ÿ rá»™ng `.bb` vÃ  lÃ  thÃ nh pháº§n quan trá»ng giÃºp **BitBake** hiá»ƒu cÃ¡ch biÃªn dá»‹ch má»™t pháº§n má»m.

#### Class (`.bbclass`)
Class (cÃ¡c tá»‡p .bbclass) chá»©a cÃ¡c Ä‘oáº¡n mÃ£ dÃ¹ng chung Ä‘á»ƒ sá»­ dá»¥ng trong nhiá»u recipe khÃ¡c nhau. Thay vÃ¬ láº·p láº¡i mÃ£ trong tá»«ng recipe, báº¡n cÃ³ thá»ƒ Ä‘áº·t cÃ¡c hÃ nh Ä‘á»™ng chung trong má»™t class.
**VÃ­ dá»¥:** autotools.bbclass cung cáº¥p cÃ¡c lá»‡nh cáº§n thiáº¿t Ä‘á»ƒ biÃªn dá»‹ch pháº§n má»m dÃ¹ng cÃ´ng cá»¥ autotools.

VÃ­ `Poky` nhÆ° nhÃ  hÃ ng thÃ¬, `bitbake` lÃ m Ä‘áº§u báº¿p xÃ o náº¥u theo cÃ¡c cÃ´ng thá»©c lÃ  `metadata` ra cÃ¡c file image mÃ¬nh cáº§n.

#### Package
**Package** lÃ  káº¿t quáº£ Ä‘áº§u ra cá»§a quÃ¡ trÃ¬nh biÃªn dá»‹ch trong Yocto. Má»—i package chá»©a cÃ¡c tá»‡p thá»±c thi, thÆ° viá»‡n, hoáº·c dá»¯ liá»‡u cáº§n thiáº¿t Ä‘á»ƒ cÃ i Ä‘áº·t vÃ  sá»­ dá»¥ng pháº§n má»m trÃªn há»‡ thá»‘ng Ä‘Ã­ch. BitBake sáº½ táº¡o ra cÃ¡c package nÃ y dÆ°á»›i dáº¡ng .ipk, .deb, hoáº·c .rpm dá»±a trÃªn cáº¥u hÃ¬nh.


## ğŸ”§ 3. Poky 
- `bitbake/` Chá»©a táº¥t cáº£ cÃ¡c script dÃ¹ng cho lá»‡nh `bitbake`.
- `documentation/` chÆ°a tÃ i liá»‡u yocto project.
- `meta/` chá»©a `metadate` cá»§a **OpenEmbedded-Core**.
- `meta-skeleton/`: Chá»©a máº«u recipes cá»§a BSP vÃ  Kernel Development.
- `meta-poky/`: Chá»©a cáº¥u hÃ¬nh cho báº£n Poky distro.
- `meta-yocto-bsp/`: Chá»©a cáº¥u hÃ¬nh BSP cho hardware board.
- `LICENSE` File giáº¥y phÃ©p (license) mÃ  Poky Ä‘Æ°á»£c phÃ¢n phá»‘i theo, gá»“m sá»± káº¿t há»£p giá»¯a GPLv2 vÃ  MIT.
- `oe-init-build-env`: Script Ä‘á»ƒ thiáº¿t láº­p mÃ´i trÆ°á»ng build OpenEmbedded. Khi cháº¡y script nÃ y, nÃ³ sáº½ táº¡o thÆ° má»¥c build.
- `scripts/`: Chá»©a cÃ¡c script Ä‘á»ƒ setup environment, development tools vÃ  cÃ´ng cá»¥ flash (náº¡p) cÃ¡c image Ä‘Ã£ build vÃ o thiáº¿t bá»‹ Ä‘Ã­ch (target).


## ğŸ›  4. Yocto Project Workflow

![alt text](/assets/Linux/Yocto/image-18.png)

### 1. ğŸ“¥ Source Fetching

![alt text](/assets/Linux/Yocto/image-19.png)

Táº£i source xuá»‘ng trÃªn server vÃ  giáº£i nÃ©n.
**do fetch**
**do_unpack**

### 2. ğŸ”§ Patching (Báº£n vÃ¡)

![alt text](/assets/Linux/Yocto/image-20.png)

Sau khi táº£i xong thÃ¬ yocto sá»­ dá»¥ng cÃ¡c báº£n vÃ¡ thÃ´ng qua biáº¿n file `.patch` hoáº·c `.diff`.
**do_patch**

### 3. âš™ï¸ Configuration and Compilation

![alt text](/assets/Linux/Yocto/image-21.png)

`$ source oe-init-build-env [build_dir]`
`$ build_dir> bitbake <target>`
Sau khi patch xong thá»±c hiá»‡n viá»‡c cáº¥u hÃ¬nh.
**do_configure**
**do_compile**
**do_install**

### 4. ğŸ’¿ Image Generation

![alt text](/assets/Linux/Yocto/image-22.png)

build ra rootfs sau khi xong thá»±c hiá»‡n ra image
**do_rootfs**
**do_image**

## ğŸ”„ CÃ¡c bÆ°á»›c build
### 1. ğŸ’» Chuáº©n bá»‹ bÃªn mÃ¡y host (PC ubuntu)
Ubuntu 20 thÃ¬ khÃ´ng sao, nhÆ°ng Ä‘á»• lÃªn thÃ¬ bá»‹ cáº¥p quyá»n má»›i build Ä‘Æ°á»£c. NÃªn há»i chatgpt.

```bash
sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib \
     build-essential chrpath socat cpio python3 python3-pip python3-pexpect \
     libsdl1.2-dev xterm make xsltproc docbook-utils fop dblatex xmlto
```
### ğŸ“¦ Clone source code 
```bash
git clone -b kirkstone git://git.yoctoproject.org/poky/
 
cd poky
 
git clone -b kirkstone git://git.openembedded.org/meta-openembedded
 
git clone -b kirkstone git://git.yoctoproject.org/meta-ti
 
git clone -b kirkstone https://git.yoctoproject.org/meta-arm
```
**meta-ti**: BSP cá»§a board
**meta-arm**: core arm

### ğŸ”¨ Setup vÃ  build
```bash
source oe-init-build-env build-bbb
```
- Set **$OEROOT** : XÃ¡c Ä‘á»‹nh thÆ° má»¥c gá»‘c cá»§a yocto
- Set **$PATH** : ThÃªm bitbake vÃ o path cá»§a session terminal, giá»‘ng kiá»ƒu thÃªm vÃ o biáº¿n mÃ´i trÆ°á»ng á»Ÿ Windows
- Set **$BUILDDIR** : Chá»n thÆ° má»¥c output ./build-bbb (default sáº½ lÃ  build, nhÆ°ng náº¿u cháº¡y cho nhiá»u board thÃ¬ nÃªn chia riÃªng)
- Set **$BBPATH** : Äá»ƒ bitbake tÃ¬m tháº¥y cÃ¡c layer
Táº¡o cáº¥u trÃºc thÆ° má»¥c **$BUILDDIR**.

Sau khi cháº¡y xong build ra file conf, trong Ä‘Ã³ cÃ³ cÃ¡c file layer Ä‘Æ°á»£c gen ra nhÆ° (**bblayers.conf**, **local.conf**,...).

### ğŸ“ Thay Ä‘á»•i conf file
#### `local.conf`.
- `MACHINE`: Muá»‘n build cho thiáº¿t bá»‹ nÃ o nhÆ° beangle bone cÃ¡c thá»©.
- `DL_DIR`: Khi build nÃ³ sáº½ táº£i thÆ° má»¥c cáº§n thiáº¿t Ä‘á»ƒ vÃ o trong thÆ° má»¥c Ä‘Æ°á»ng dáº«n Ä‘á»ƒ sáºµn.
- `PACKAGE_CLASSES`: Muá»‘n nÃ©n thÃ nh package gÃ¬ nhÆ° `rpm`, ...
- `EXTRA_IMAGE_FEATURES`: thÃªm feature cá»§a yocto thÃ¬ feature nÃ y Ä‘Æ°á»£c liá»‡t kÃª háº¿t trÃªn trang chÃ­nh yocto. Xem á»Ÿ link nÃ y. 

[Feature](https://docs.yoctoproject.org/brief-yoctoprojectqs/index.html)

```bash
EXTRA_IMAGE_FEATURES ?= "debug-tweaks ssh-server-dropbear"
```
thÃªm 2 feature má»—i feature cÃ¡ch nhau dáº¥u cÃ¡ch
- `IMAGE_INSTALL`: thÃªm package
thÃªm bÃ¬nh thÆ°á»ng
```bash
IMAGE_INSTALL = "bc"
```
thÃªm vÃ o cuá»‘i thÃ¬ pháº£i thÃªm vÃ o dáº¥u cÃ¡ch
```bash
IMAGE_INSTALL_append = " bc"
```

#### `bblayer.conf`
Äá»‹nh nghÄ©a viá»‡c dÃ¹ng meta data nÃ o layer nÃ o chá»‰ cáº§n liá»‡t kÃª Ä‘Æ°á»ng dáº«n vÃ o lÃ  Ä‘Æ°á»£c.

### ğŸš€ Build
```bash
bitbake core-image-minimal
```

### ğŸ§ª Thá»­ trÃªn Ubuntu 
build báº£n quemux86-64 thÃ¬ cháº¡y báº£n vá»«a build
Äá»©ng á»Ÿ thÆ° má»¥c build
```bash
runqemu qemux86-64 nographic
```

## ğŸ“š Meta Layers trong Yocto

### 1. ğŸŒŸ CÃ¡c Meta Layer Cá»‘t LÃµi

#### 1.1 ğŸ“¦ meta-poky
- LÃ  layer cá»‘t lÃµi cá»§a Poky distribution
- Chá»©a cÃ¡c cáº¥u hÃ¬nh máº·c Ä‘á»‹nh vÃ  recipes cÆ¡ báº£n
- Äá»‹nh nghÄ©a báº£n phÃ¢n phá»‘i tham chiáº¿u Poky

#### 1.2 ğŸ”§ meta-yocto-bsp
- Board Support Package (BSP) layer chÃ­nh thá»©c
- Há»— trá»£ cÃ¡c board tham chiáº¿u cá»§a Yocto
- Chá»©a cáº¥u hÃ¬nh pháº§n cá»©ng vÃ  driver

#### 1.3 ğŸ—ï¸ meta (OpenEmbedded-Core)
- Layer cá»‘t lÃµi tá»« OpenEmbedded
- Chá»©a cÃ¡c recipes cÆ¡ báº£n nháº¥t
- Ná»n táº£ng cho táº¥t cáº£ cÃ¡c layer khÃ¡c

### 2. ğŸ” Meta Layer Phá»• Biáº¿n

#### 2.1 meta-openembedded
```bash
git clone -b kirkstone git://git.openembedded.org/meta-openembedded
```
Bá»™ sÆ°u táº­p cÃ¡c layer phá»• biáº¿n:
- **meta-oe**: CÃ¡c package cÆ¡ báº£n
- **meta-networking**: CÃ¡c gÃ³i máº¡ng
- **meta-python**: Package Python
- **meta-multimedia**: Codec vÃ  framework multimedia

#### 2.2 meta-qt5
Há»— trá»£ Qt5 framework:
```bash
git clone -b kirkstone https://github.com/meta-qt5/meta-qt5.git
```

### 3. ğŸ“± Meta Layer cho Vi Ä‘iá»u khiá»ƒn

#### 3.1 meta-arm
```bash
git clone -b kirkstone https://git.yoctoproject.org/meta-arm
```
- Há»— trá»£ kiáº¿n trÃºc ARM
- Toolchain vÃ  firmware ARM
- Trusted Firmware-A (TF-A)

#### 3.2 meta-ti
```bash
git clone -b kirkstone git://git.yoctoproject.org/meta-ti
```
- BSP cho Texas Instruments
- Há»— trá»£ BeagleBone, AM335x
- SDK vÃ  tools TI

### 4. ğŸ› ï¸ Táº¡o Meta Layer Má»›i

[Create_Layer](https://docs.yoctoproject.org/dev/dev-manual/layers.htm)
```bash
bitbake-layers create-layer meta-scottrif
```
Sau khi cháº¡y cÅ©ng cÃ³ conf nhÆ° máº¥y cÃ¡i meta bÃ¬nh thÆ°á»ng

`meta-scottrif` sáº½ lÃ  tÃªn layer muá»‘n Ä‘áº·t.

## Thá»±c hiá»‡n build
### 1. CÃ i Ä‘áº·t cÃ¡c package cáº§n thiáº¿t
CÃ i Ä‘áº¡t cÃ¡c package cáº§n thiáº¿t trÃªn mÃ¡y host Ubuntu:
```bash
sudo apt install gawk wget git diffstat unzip texinfo gcc build-essential chrpath socat \
cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping \
python3-git python3-jinja2 python3-subunit zstd liblz4-tool file locales libacl1
```

### 2. Thiáº¿t láº­p mÃ´i trÆ°á»ng Yocto
#### 2.1. Clone Yocto Poky
```bash
git clone git://git.yoctoproject.org/poky
cd poky
```

Náº¿u báº¡n dÃ¹ng Yocto cá»§a nhÃ  sáº£n xuáº¥t (Renesas, NXP, TI...), báº¡n cáº§n clone thÃªm BSP layer:
- **Renesas**: meta-renesas
- **NXP i.MX**: meta-freescale
- **Raspberry Pi**: meta-raspberrypi
- **TI**: meta-ti

**VÃ­ dá»¥**:
```bash
git clone https://github.com/meta-raspberrypi/meta-raspberrypi.git
```
VÃ­ dá»¥ mÃ¡y host ubuntu 22.4 thÃ¬ pháº£i tÃ¬m repo há»• trá»£ 22.4.
#### 2.2. Khá»Ÿi táº¡o mÃ´i trÆ°á»ng build
Táº£i xuá»‘ng meta-openembedded:
```bash
git clone git://git.openembedded.org/meta-openembedded -b dunfell
```
Lá»‡nh nÃ y sáº½ thiáº¿t láº­p cÃ¡c biáº¿n mÃ´i trÆ°á»ng cáº§n thiáº¿t:
```bash
source oe-init-build-env
```
Lá»‡nh nÃ y táº¡o thÆ° má»¥c:
```bash
build/
â”œâ”€â”€ conf/
â”‚   â”œâ”€â”€ local.conf
â”‚   â””â”€â”€ bblayers.conf
```
#### 2.3. Cáº¥u hÃ¬nh build
##### Cáº¥u hÃ¬nh `build/conf/bblayers.conf`:
```bash
BBLAYERS ?= " \
  /home/aosp/yocto/poky/meta \
  /home/aosp/yocto/poky/meta-poky \
  /home/aosp/yocto/poky/meta-yocto-bsp \
  /home/aosp/yocto/poky/build/workspace \
  /home/aosp/yocto/poky/meta-raspberrypi \
  /home/aosp/yocto/poky/meta-openembedded/meta-oe \
  "
```
cÃ³ thá»ƒ thÃªm cÃ¡c meta Ä‘á»ƒ build nhÆ° trÃªn.

##### Cáº¥u hÃ¬nh `build/conf/local.conf`:
```bash
# MACHINE ??= "qemux86-64"
MACHINE ??= "raspberrypi0-wifi"
```
VÃ­ dá»¥ á»Ÿ Ä‘Ã¢y thÃ¬ Ä‘ang cho raspberry pi 0 wifi. Táº¡i sao pháº£i lÃ  `raspberrypi0-wifi` Ä‘Ãºng tÃªn nÃ y thÃ¬ lÃ  do trong meta nhÆ° hÃ¬nh dÆ°á»›i cÃ³ quy Ä‘á»‹nh chá»‰ gá»i ra build.

![alt text](/assets/Linux/Yocto/meta_rasp.png)

Náº¿u muá»‘n port ra uart thÃ¬ cáº¥u hÃ¬nh thÃªm.
```bash
ENABLE_UART = "1"
```
![alt text](/assets/Linux/Yocto/meta_rasp.png)

### Build Yocto

![alt text](/assets/Linux/Yocto/image_yoctobuild.png)
LÃºc cháº¡y build mÃ´i trÆ°á»ng Ä‘Ã£ ra rá»“i nÃªn chá»n nÃ o Ä‘á»ƒ cháº¡y thÃ´i.

** Build image máº·c Ä‘á»‹nh: **
```bash
bitbake core-image-minimal
```
** Build image desktop: ** 
```bash
bitbake core-image-sato
```

CÃ³ thá»ƒ xem xem cÃ³ taget nÃ o cÃ³ sáºµn:
```bash
bitbake -s | grep image
```

Sau khi build xong tÃ¬m file Ä‘uÃ´i `wic.z2`
```bash
ls | grep wic.bz2
```
náº±m á»Ÿ `build/tmp/deploy/images/<MACHINE>/`

### Flash lÃªn board
TÃ¹y mÃ¡y:

âœ” Image `.wic`

```bash
sudo dd if=/dev/zero of=/dev/sdb bs=512 count=1 
sudo dd if=core-image-minimal.wic of=/dev/sdX bs=4M status=progress
sync
```

`sudo dd if=/dev/zero of=/dev/sdb bs=512 count=1` sáº½ ghi Ä‘Ã¨ 512 bytes Ä‘áº§u tiÃªn cá»§a á»• /dev/sdb.

âœ” Image `.sdimg` (NXP, Renesas):
```bash
bmaptool copy <image>.sdimg /dev/sdX
```
## KERNEL
Giáº£i nÃ©n gÃ³i kernel:
```bash
bitbake virtual/kernel -c configure
```

Build SDK:
Äá»©ng táº¡i poky
```bash
cd poky
#sato
bitbake core-image-sato -c populate_sdk

#minimal
bitbake core-image-minimal -c populate_sdk
```

cháº¡y xong ra file script.
```bash
cd tmp/deploy/sdk/
```
ra file `.sh` thÃ¬ cháº¡y Ä‘á»ƒ build tren mÃ¡y Ä‘Æ°á»ng dáº«n máº·c Ä‘á»‹nh.
```bash
cd /opt/poky/5.2.99+snapshot/
```
pháº§n cho cross compile
![alt text](/assets/Linux/Yocto/poky.png)

Cháº¡y gÃ¡n biáº¿n mÃ´i trÆ°á»ng KDIR
```bash
echo KDIR
```
xem cÃ³ chÆ°a
```bash
bitbake -e virtual/kernel | grep
```
![alt text](/assets/Linux/Yocto/kdir.png)

ÄÆ°a Ä‘Æ°á»ng dáº«n vá»«a láº¥y ra Ä‘Ã³ vÃ o
```bash
export KDIR={path}
```

Build cÃ¡c script há»— trá»£
```bash
make -C $KDIR scripts
```

Sau Ä‘Ã³ Ä‘Ã£ Ä‘á»§ mÃ´i trÆ°á»ng Ä‘á»ƒ lÃ m.
** Kiá»ƒm tra kiáº¿n trÃºc **
```bash
echo $ARCH
```
** Kiá»ƒm tra kiáº¿n trÃºc **
```bash
echo $CROSS_COMPILE
```